#!/bin/bash

# Using a shell helper library argsparse.sh
# Encoding the argsparse.sh script inside this script for ease of use (using base64 encoding)
# Makes sharing and using the script easier without major overhaed
argparse="IyEvdXNyL2Jpbi9lbnYgYmFzaAojIC0qLSB0YWItd2lkdGg6IDQ7IGVuY29kaW5nOiB1dGYtODsgLSotCiMKIyMgQGZpbGUKIyMgQGF1dGhvciBEYW1pZW4gTmFkw6kgPGJhc2gtYXJnc3BhcnNlQGxpdm5hLm9yZz4KIyMgQGNvcHlyaWdodCBXVEZQTHYyCiMjIEB2ZXJzaW9uIDEuOAojIyBAYnJpZWYgQmFzaCBBcmdzcGFyc2UgTGlicmFyeQojIyBAZGV0YWlscwojIyBAcGFyIFVSTAojIyBodHRwczovL2dpdGh1Yi5jb20vQW52aWwvYmFzaC1hcmdzcGFyc2UgQG4KIyMKIyMgQHBhciBQdXJwb3NlCiMjCiMjIFRvIHJlcGxhY2UgdGhlIG9wdGlvbi1wYXJzaW5nIGFuZCB1c2FnZS1kZXNjcmliaW5nIGZ1bmN0aW9ucwojIyBjb21tb25seSByZXdyaXR0ZW4gaW4gYWxsIHNjcmlwdHMuCiMjCiMjIEBub3RlCiMjIFRoaXMgbGlicmFyeSBpcyBpbXBsZW1lbnRlZCBmb3IgYmFzaCB2ZXJzaW9uIDQuIFByaW9yIHZlcnNpb25zIG9mCiMjIGJhc2ggd2lsbCBmYWlsIGF0IGludGVycHJldGluZyB0aGF0IGNvZGUuCiMjIEBub3RlCiMjIFRoZSBleHRnbG9iIHNoZWxsIG9wdGlvbiB3aWxsIGJlIGVuYWJsZWQgYW5kIHBvc2l4IG1vZGUgd2lsbCBiZQojIyBkaXNhYmxlZCB3aGVuIGxvYWRpbmcgdGhlIGxpYnJhcnkuIENoYW5naW5nIHRob3NlIHNldHRpbmdzCiMjIGFmdGVyd2FyZHMgd2lsbCBtYWtlIHRoZSBsaWJyYXJ5IGV4ZWN1dGlvbiBmYWlsLgojIwojIyBAcGFyIFVzYWdlCiMjIFVzZSB0aGUgYXJnc3BhcnNlX3VzZV9vcHRpb24oKSBmdW5jdGlvbiB0byBkZWNsYXJlIHlvdXIgb3B0aW9ucyB3aXRoCiMjIHRoZWlyIHNpbmdsZSBsZXR0ZXIgY291bnRlcnBhcnRzLCBhbG9uZyB3aXRoIHRoZWlyIGRlc2NyaXB0aW9uLgojIwojIyBAcGFyCiMjIFRoZSBhcmdzcGFyc2VfdXNlX29wdGlvbigpIHN5bnRheCBpczoKIyMKIyMgQGNvZGUKIyMgICAgIGFyZ3NwYXJzZV91c2Vfb3B0aW9uICJvcHRzdHJpbmciICJvcHRpb24gZGVzY3JpcHRpb24gc3RyaW5nIiBcCiMjICAgICBbICJwcm9wZXJ0eSIgLi4uIF0gWyAib3B0aW9uYWwgZGVmYXVsdCB2YWx1ZSIgXQojIyBAZW5kY29kZQojIwojIwojIyBAcGFyCiMjIEFuICJvcHRzdHJpbmciIGlzIG9mIHRoZSBmb3JtICJzb209ZXN0cmluZzoiLiBUaGlzIHdvdWxkIGRlY2xhcmUgYQojIyBsb25nIG9wdGlvbiBuYW1lZCBzb21lc3RyaW5nLiBUaGUgZW5kaW5nICI6IiBpcyBvcHRpb25hbCBhbmQsIGlmCiMjIHByZXNlbnQsIG1lYW5zIHRoZSBsb25nIG9wdGlvbiBleHBlY3RzIGEgdmFsdWUgb24gdGhlIGNvbW1hbmQKIyMgbGluZS4gVGhlICI9IiBjaGFyIGlzIGFsc28gb3B0aW9uYWwgYW5kIG1lYW5zIHRoZSBpbW1lZGlhdGx5CiMjIGZvbGxvd2luZyBsZXR0ZXIgaXMgdGhlIHNob3J0IHNpbmdsZS1sZXR0ZXIgZXF1aXZhbGVudCBvcHRpb24gb2YKIyMgLS1zb21ldGhpbmcuCiMjCiMjIEBwYXIKIyMgVGhlICJzb21ldGhpbmciIHN0cmluZyBtdXN0IG9ubHkgY29udGFpbnMgQVNDSUkKIyMgbGV0dGVycy9udW1iZXJzL2Rhc2gvdW5kZXJzY29yZSBjaGFyYWN0ZXJzLgojIwojIyBAbm90ZQojIyBXaGF0IGlzIHJlZmVycmVkIGxhdGVyIGFzICJvcHRpb24iIG9yICJvcHRpb24gbmFtZSIgKG9yIGV2ZW4gImxvbmcKIyMgb3B0aW9uIG5hbWUiKSBpcyB0aGUgb3B0c3RyaW5nIHdpdGhvdXQgdGhlICc6JyBhbmQgJz0nIGNoYXJhY3RlcnMuCiMjCiMjCiMjCiMjIEBwYXIgT3B0aW9ucyBtYXkgaGF2ZSBwcm9wZXJ0aWVzLgojIwojIyBQcm9wZXJ0aWVzIGFyZSBzZXQgZWl0aGVyIGF0IG9wdGlvbiBkZWNsYXJhdGlvbnMgdGhyb3VnaCB0aGUKIyMgYXJnc3BhcnNlX3VzZV9vcHRpb24oKSBmdW5jdGlvbiwgb3IgdXNpbmcgdGhlCiMjIGFyZ3NwYXJzZV9zZXRfb3B0aW9uX3Byb3BlcnR5KCkgZnVuY3Rpb24KIyMKIyMgVGhlIGN1cnJlbnRseSBzdXBwb3J0ZWQgcHJvcGVydGllcyBhcmU6CiMjCiMjIC0gImhpZGRlbiIgQG4KIyMgCSBBbiBoaWRkZW4gb3B0aW9uIHdpbGwgbm90IGJlIHNob3duIGluIHVzYWdlLgojIwojIyAtICJtYW5kYXRvcnkiIEBuCiMjIAkgQW4gb3B0aW9uIG1hcmtlZCBhcyBtYW5kYXRvcnkgaXMgcmVxdWlyZWQgb24gdGhlIGNvbW1hbmQgbGluZS4gSWYKIyMgICBhIG1hbmRhdG9yeSBvcHRpb24gaXMgb21pdGVkIGJ5IHRoZSB1c2VyLCB1c2FnZSgpIHdpbGwgYmUKIyMgICB0cmlnZ2VyZWQgYnkgYXJnc3BhcnNlX3BhcnNlX29wdGlvbnMoKS4KIyMKIyMgLSAidmFsdWUiIEBuCiMjICAgT24gdGhlIGNvbW1hbmQgbGluZSwgdGhlIG9wdGlvbiB3aWxsIHJlcXVpcmUgYSB2YWx1ZS4KIyMgCSBTYW1lIGVmZmVjdCBpZiB5b3UgZW5kIHlvdXIgb3B0c3RyaW5nIHdpdGggYSAnOicgY2hhci4KIyMKIyMgLSAiZGVmYXVsdDo8ZGVmYXVsdHZhbHVlPiIgQG4KIyMgCSBUaGUgZGVmYXVsdCB2YWx1ZSBmb3IgdGhlIG9wdGlvbi4KIyMKIyMgLSAic2hvcnQ6PGNoYXI+IiBAbgojIyAgIFRoZSBzaG9ydCBzaW5nbGUtbGV0dGVyIGVxdWl2YWxlbnQgb2YgdGhlIG9wdGlvbi4KIyMKIyMgLSAidHlwZTo8dHlwZW5hbWU+IiBAbgojIyAgIEdpdmUgYSB0eXBlIHRvIHRoZSBvcHRpb24gdmFsdWUuIFVzZXIgaW5wdXQgdmFsdWUgd2lsbCBiZSBjaGVja2VkCiMjIAkgYWdhaW5zdCBidWlsdC1pbiB0eXBlIHZlcmlmaWNhdGlvbnMgX29yXyB0aGUKIyMgCSAiY2hlY2tfdHlwZV88dHlwZW5hbWU+IiBmdW5jdGlvbi4gWW91IGNhbm5vdCBvdmVycmlkZSBhIGJ1aWx0LWluCiMjIAkgdHlwZS4gQnVpbHQtaW4gdHlwZXMgYXJlOgojIyAgIC0gZmlsZQojIyAgIC0gZGlyZWN0b3J5CiMjICAgLSBwaXBlCiMjICAgLSB0ZXJtaW5hbAojIyAgIC0gc29ja2V0CiMjICAgLSBsaW5rCiMjICAgLSBjaGFyCiMjICAgLSB1bnNpZ25lZGludAojIyAgIC0gdWludAojIyAgIC0gaW50ZWdlcgojIyAgIC0gaW50CiMjICAgLSBoZXhhCiMjICAgLSBpcHY0CiMjICAgLSBpcHY2CiMjICAgLSBpcAojIyAgIC0gaG9zdG5hbWUKIyMgICAtIGhvc3QKIyMgICAtIHBvcnRudW1iZXIKIyMgICAtIHBvcnQKIyMgICAtIHVzZXJuYW1lCiMjICAgLSBncm91cAojIyAgIC0gZGF0ZQojIyAgIC4KIyMKIyMgLSAiZXhjbHVkZTo8b3B0aW9uPiA8b3B0aW9uPiIgQG4KIyMgICBUaGUgZXhjbHVkZSBwcm9wZXJ0eSB2YWx1ZSBpcyBhIHNwYWNlLXNlcGFyYXRlZCBsaXN0IG9mIG90aGVyCiMjICAgb3B0aW9ucy4gVXNlciB3b250IGJlIGFibGUgdG8gcHJvdmlkZWQgdHdvIG11dHVhbGx5IGV4Y2x1c2l2ZQojIyAgIG9wdGlvbnMgb24gdGhlIGNvbW1hbmQgbGluZS4gQG4KIyMKIyMgICBlLmc6IGlmIHlvdSBzZXQgZXhjbHVkZSBwcm9wZXJ0eSBmb3IgdGhlIC0tZm9vIG9wdGlvbiB0aGlzIHdheToKIyMgICBAY29kZSBhcmdzcGFyc2Vfc2V0X29wdGlvbl9wcm9wZXJ0eSAiZXhjbHVkZTpvcHQxIG9wdDIiIGZvbyBAZW5kY29kZQojIyAgIFRoZW4gLS1vcHQxIGFuZCAtLWZvbyBhcmUgbm90IGFsbG93ZWQgb24gdGhlIHNhbWUgY29tbWFuZCBsaW5lCiMjICAgaW52b2thdGlvbi4gQW5kIHNhbWUgZ29lcyBmb3IgLS1vcHQyIGFuZCAtLWZvby4KIyMgICBUaGlzIGZvbyBleGNsdWRlIHByb3BlcnR5IHNldHRpbmcgd291bGRudCBtYWtlIC0tb3B0MSBhbmQgLS1vcHQyLAojIyAgIG11dHVhbGx5IGV4Y2x1c2l2ZSB0aG91Z2guCiMjCiMjIC0gImFsaWFzOjxvcHRpb24+IDxvcHRpb24+IiBAbgojIyAgIFRoaXMgcHJvcGVydHkgYWxsb3dzIGFuIG9wdGlvbiB0byBzZXQgbXVsdGlwbGUgb3RoZXIgd2l0aG91dC12YWx1ZQojIyAgIG9wdGlvbnMgaW5zdGVhZC4gUmVjdXJzaXZlIGFsaWFzZXMgYXJlIHBlcm1pdHRlZCBidXQgbm8gbG9vcAojIyAgIGRldGVjdGlvbiBpcyBtYWRlLCBzbyBiZSBjYXJlZnVsLiBAbgojIyAgIGUuZzogaWYgeW91IGRlY2xhcmUgYW4gb3B0aW9uICdvcHQnIGxpa2UgdGhpczoKIyMgICBAY29kZSBhcmdzcGFyc2VfdXNlX29wdGlvbiBvcHQgIm15IGRlc2NyaXB0aW9uIiAiYWxpYXM6b3B0MSBvcHQyIiBAZW5kY29kZQojIyAgIFRoZW4gaWYgdGhlIHVzZXIgaXMgZG9pbmcgLS1vcHQgb24gdGhlIGNvbW1hbmQgbGluZSwgaXQgd2lsbCBiZSBhcwojIyAgIGlmIGhlIHdvdWxkIGhhdmUgZG9uZSAtLW9wdDEgLS1vcHQyCiMjCiMjIC0gY3VtdWxhdGl2ZSBAbgojIyAgIEltcGxpZXMgJ3ZhbHVlJy4KIyMgICBFdmVyeXRpbWUgYSBjdW11bGF0aXZlIG9wdGlvbiAib3B0aW9ubmFtZSIgaXMgcGFzc2VkIG9uIHRoZQojIyAgIGNvbW1hbmQgbGluZSwgdGhlIHZhbHVlIGlzIHN0b3JlZCBhdCB0aGUgZW5kIG9mIGFuIGFycmF5IG5hbWVkCiMjICAgImN1bXVsYXRlZF92YWx1ZXNfPG9wdGlvbm5hbWU+Ii4gQG4KIyMKIyMgICBlLmc6IGZvciBhIHNjcmlwdCB3aXRoIGFuIG9wdDEgb3B0aW9uIGRlY2xhcmVkIHRoaXMgd2F5OgojIyAgIEBjb2RlIGFyZ3NwYXJzZV91c2Vfb3B0aW9uIG9wdDEgInNvbWUgZGVzY3JpcHRpb24iIGN1bXVsYXRpdmUgQGVuZGNvZGUKIyMgICBhbmQgaW52b2tlZCB3aXRoOgojIyAgIEBjb2RlIC0tb3B0MSB2YWx1ZTEgLS1vcHQxIHZhbHVlMiBAZW5kY29kZQojIyAgIGFmdGVyIGFyZ3NwYXJzZV9wYXJzZV9vcHRpb25zKCksICIke2N1bXVsYXRlZF92YWx1ZXNfb3B0MVswXX0iIHdpbGwKIyMgICBleHBhbmQgdG8gdmFsdWUxLCBhbmQgJHtjdW11bGF0ZWRfdmFsdWVzX29wdDFbMV19IHdpbGwgZXhwYW5kIHRvCiMjICAgdmFsdWUyLgojIwojIyAtIGN1bXVsYXRpdmVzZXQgQG4KIyMgICBFeGFjdGx5IGxpa2UgY3VtdWxhdGl2ZSwgZXhjZXB0IG9ubHkgdW5pcSB2YWx1ZXMgYXJlIGtlcHQuIEBuCiMjCiMjICAgZS5nOiBmb3IgYSBzY3JpcHQgd2l0aCBhbiBvcHQxIG9wdGlvbiBkZWNsYXJlZCB0aGlzIHdheToKIyMgICBAY29kZSBhcmdzcGFyc2VfdXNlX29wdGlvbiBvcHQxICJzb21lIGRlc2NyaXB0aW9uIiBjdW11bGF0aXZlc2V0IEBlbmRjb2RlCiMjICAgYW5kIGludm9rZWQgd2l0aDoKIyMgICBAY29kZSAtLW9wdDEgdmFsdWUxIC0tb3B0MSB2YWx1ZTIgLS1vcHQxIHZhbHVlMSBAZW5kY29kZQojIyAgIGFmdGVyIGFyZ3NwYXJzZV9wYXJzZV9vcHRpb25zKCksICIke2N1bXVsYXRlZF92YWx1ZXNfb3B0MVswXX0iIHdpbGwKIyMgICBleHBhbmQgdG8gdmFsdWUxLCBhbmQgIiR7Y3VtdWxhdGVkX3ZhbHVlc19vcHQxWzFdfSIgd2lsbCBleHBhbmQgdG8KIyMgICB2YWx1ZTIuIFRoZXJlIHdvdWxkIGJlIG5vICIke2N1bXVsYXRlZF92YWx1ZXNfb3B0MVsyXX0iIHZhbHVlLgojIwojIyAtICJyZXF1aXJlOjxvcHRpb24+IDxvcHRpb24+IiBAbgojIyAgIENyZWF0ZXMgYSBkZXBlbmRlbmN5IGJldHdlZW4gb3B0aW9ucy4gaWYgeW91IGRlY2xhcmUgYW4gb3B0aW9uIHdpdGg6CiMjICAgQGNvZGUKIyMgICBhcmdzcGFyc2VfdXNlX29wdGlvbiBvcHQxICJzb21ldGhpbmciIHJlcXVpcmU6Im9wdDIgb3B0MyIKIyMgICBAZW5kY29kZQojIyAgIGFyZ3NwYXJzZV9wYXJzZV9vcHRpb25zKCkgd291bGQgcmV0dXJuIHdpdGggYW4gZXJyb3IgaWYgIi0tb3B0MSIKIyMgICBpcyBnaXZlbiBvbiB0aGUgY29tbWFuZGUgbGluZSB3aXRob3V0ICItLW9wdDIiIG9yIHdpdGhvdXQgIi0tb3B0MyIuCiMjCiMjIEBwYXIKIyMgWW91IGNhbiB0ZXN0IGlmIGFuIG9wdGlvbiBoYXMgYSBwcm9wZXJ0eSB1c2luZyB0aGUKIyMgYXJnc3BhcnNlX2hhc19vcHRpb25fcHJvcGVydHkoKSBmdW5jdGlvbi4KIyMgQGNvZGUgYXJnc3BhcnNlX2hhc19vcHRpb25fcHJvcGVydHkgPG9wdGlvbj4gPHByb3BlcnR5PiBAZW5kY29kZQojIwojIwojIyBAcGFyIFBhcnNpbmcgcG9zaXRpb25uYWwgcGFyYW1ldGVycwojIyBBZnRlciB0aGUgb3B0aW9ucyBhcmUgZGVjbGFyZWQsIGludm9rZSB0aGUgZnVuY3Rpb24KIyMgYXJnc3BhcnNlX3BhcnNlX29wdGlvbnMoKSB3aXRoIHRoZSBhbGwgc2NyaXB0IHBhcmFtZXRlcnMuIFRoaXMgd2lsbAojIyBkZWZpbmU6CiMjCiMjIC0gcHJvZ3JhbV9wYXJhbXMsIGFuIGFycmF5LCBjb250YWluaW5nIGFsbCBub24tb3B0aW9uIHBhcmFtZXRlcnMuCiMjCiMjIC0gcHJvZ3JhbV9vcHRpb25zLCBhbiBhc3NvY2lhdGl2ZSBhcnJheS4gRm9yIGVhY2ggcmVjb3JkIG9mIHRoZQojIyAgIGFycmF5OgojIyAgIC0gVGhlIGtleSBpcyB0aGUgbG9uZyBvcHRpb24gbmFtZS4KIyMgICAtIEFuZCBhYm91dCB2YWx1ZXM6CiMjICAgICAtIElmIG9wdGlvbiBkb2Vzbid0IGV4cGVjdCBhIHZhbHVlIG9uIHRoZSBjb21tYW5kIGxpbmUsIHRoZQojIyAgICAgICB2YWx1ZSByZXByZXNlbnRzIGhvdyBtYW55IHRpbWVzIHRoZSBvcHRpb24gaGFzIGJlZW4KIyMgICAgICAgZm91bmQgb24gdGhlIGNvbW1hbmQgbGluZQojIwojIyAgICAgLSBJZiBvcHRpb24gZG9lcyByZXF1aXJlIGEgdmFsdWUsIHRoZSBhcnJheSByZWNvcmQgdmFsdWUgaXMgdGhlCiMjICAgICAgIHZhbHVlIG9mIHRoZSBsYXN0IG9jY3VyZW5jZSBvZiB0aGUgb3B0aW9uIGZvdW5kIG9uIHRoZSBjb21tYW5kCiMjICAgICAgIGxpbmUuCiMjICAgICAuCiMjICAgLSBJZiBvcHRpb24gaXMgY3VtdWxhdGl2ZSAob3IgY3VtdWxhdGl2ZXNldCksIHRoZSBhcnJheSByZWNvcmQKIyMgICAgIHZhbHVlIGlzIHRoZSBudW1iZXIgb2YgdmFsdWVzIHBhc3NlZCBieSB0aGUgdXNlci4KIyMgICAuCiMjCiMjIEFmdGVyIGFyZ3NwYXJzZV9wYXJzZV9vcHRpb25zKCkgaW52b2thdGlvbiwgeW91IGNhbiBjaGVjayBpZiBhbgojIyBvcHRpb24gaGF2ZSB3YXMgb24gdGhlIGNvbW1hbmQgbGluZSAob3Igbm90KSB1c2luZyB0aGUKIyMgYXJnc3BhcnNlX2lzX29wdGlvbl9zZXQoKSBmdW5jdGlvbi4gQG4KIyMKIyMgZS5nOgojIyBAY29kZSBhcmdzcGFyc2VfaXNfb3B0aW9uX3NldCAibG9uZy1vcHRpb24tbmFtZSIgQGVuZGNvZGUKIyMKIyMKIyMgQHBhciBUaGUgInVzYWdlKCkiIGZ1bmN0aW9uCiMjIElmIGEgJ3VzYWdlJyBmdW5jdGlvbiBpcyBkZWZpbmVkLCBhbmQgc2hhbGwKIyMgYXJnc3BhcnNlX3BhcnNlX29wdGlvbnMoKSByZXR1cm4gd2l0aCBub24temVybyBzdGF0dXMsICd1c2FnZScgd2lsbAojIyBiZSBhdXRvbWF0aWNhbGx5IGNhbGxlZC4KIyMKIyMgQG5vdGUKIyMgVGhpcyBsaWJyYXJ5IGF1dG9tYXRpY2FsbHkgZGVmaW5lcyBhIGRlZmF1bHQgJ3VzYWdlJyBmdW5jdGlvbiwKIyMgd2hpY2ggbWF5IGJlIHJlbW92ZWQgb3Igb3ZlcnJpZGRlbiBieSB0aGUgc291cmNpbmcgcHJvZ3JhbQojIyBhZnRlcndhcmRzLgojIwojIyBAcGFyIFZhbHVlIHNldHRpbmcgaW50ZXJuYWwgbG9naWMKIyMgRHVyaW5nIG9wdGlvbiBwYXJzaW5nLCBmb3IgZXZlcnkgb3B0aW9uIG9mIHRoZSBmb3JtICctLW9wdGlvbm5hbWUnCiMjIGV4cGVjdGluZyBhIHZhbHVlOgojIwojIyAtIElmIHRoZXJlIGV4aXN0cyBhbiBhcnJheSBuYW1lZCAib3B0aW9uXzxvcHRpb25uYW1lPl92YWx1ZXMiIGFuZAojIyAgIHRoZSB1c2VyLWdpdmVuIHZhbHVlIGRvZXNuJ3QgYmVsb25nIHRvIHRoYXQgYXJyYXksIHRoZW4gdGhlCiMjICAgYXJnc3BhcnNlX3BhcnNlX29wdGlvbnMoKSBmdW5jdGlvbiBpbW1lZGlhdGVseSByZXR1cm5zIHdpdGgKIyMgICBub24temVybyBzdGF0dXMsIHRyaWdnZXJpbmcgJ3VzYWdlJy4KIyMKIyMgLSBJZiB0aGUgIm9wdGlvbl88b3B0aW9ubmFtZT5fdmFsdWVzIiBhcnJheSBkb2VzIG5vdCBleGlzdCwgYnV0IGlmCiMjICAgdGhlIG9wdGlvbiBoYXMgYSB0eXBlIHByb3BlcnR5IGZpZWxkLCB0aGVuIHRoZSB2YWx1ZSBmb3JtYXQgd2lsbAojIyAgIGJlIGNoZWNrZWQgYWdhaW5zdCB0aGF0IHR5cGUuCiMjCiMjIC0gSWYgYSBmdW5jdGlvbiBuYW1lZCAiY2hlY2tfdmFsdWVfb2ZfPG9wdGlvbm5hbWU+IiBoYXMgYmVlbgojIyAgIGRlZmluZWQsIGl0IHdpbGwgYmUgY2FsbGVkIHdpdGggdGhlIHVzZXItZ2l2ZW4gdmFsdWUgYXMgaXRzIGZpcnN0CiMjICAgcG9zaXRpb25uYWwgcGFyYW1ldGVyLiBJZiBjaGVja192YWx1ZV9vZl88b3B0aW9ubmFtZT4gcmV0dXJucwojIyAgIHdpdGggbm9uLXplcm8gc3RhdHVzLCB0aGVuIHBhcnNlX29wdGlvbiBpbW1lZGlhdGVseSByZXR1cm5zIHdpdGgKIyMgICBub24temVybyBzdGF0dXMsIHRyaWdnZXJpbmcgdGhlICd1c2FnZScgZnVuY3Rpb24uCiMjCiMjIEBwYXIKIyMgQWxzbywgc3RpbGwgZHVyaW5nIG9wdGlvbiBwYXJzaW5nIGFuZCBmb3IgQGIgZXZlcnkgb3B0aW9uIG9mIHRoZSBmb3JtCiMjICItLW9wdGlvbm5hbWUiOgojIwojIyAtIEFmdGVyIHZhbHVlLWNoZWNraW5nLCBpZiBhIGZ1bmN0aW9uIG5hbWVkCiMjICAgInNldF9vcHRpb25fPG9wdGlvbm5hbWU+IiBleGlzdHMsIHRoZW4sIGluc3RlYWQgb2YgZGlyZWN0bHkKIyMgICBtb2RpZnlpbmcgdGhlICJwcm9ncmFtX29wdGlvbnMiIGFzc29jaWF0aXZlIGFycmF5LCB0aGlzIGZ1bmN0aW9uCiMjICAgaXMgYXV0b21hdGljYWxseSBjYWxsZWQgd2l0aCAnb3B0aW9ubmFtZScgYXMgaXRzIGZpcnN0CiMjICAgcG9zaXRpb25uYWwgcGFyYW1ldGVyLCBhbmQsIGlmICdvcHRpb25uYW1lJyBleHBlY3RlZCBhIHZhbHVlLCB0aGUKIyMgICB2YWx1ZSBpcyBnaXZlbiBhcyB0aGUgZnVuY3Rpb24gc2Vjb25kIHBvc2l0aW9ubmFsIHBhcmFtZXRlci4KIyMKIyMgQHBhciBBYm91dCBmdW5jdGlvbnMgcmV0dXJuIHZhbHVlcy4uLgojIwojIyBBbGwgYXJnc3BhcnNlIGZ1bmN0aW9ucyB3aWxsIHJldHVybiB3aXRoIGFuIGVycm9yICh1c3VhbGx5IGEgcmV0dXJuCiMjIGNvZGUgb2YgMSkgaWYgY2FsbGVkIHdpdGggYSB3cm9uZyBudW1iZXIgb2YgcGFyYW1ldGVycywgYW5kIHJldHVybgojIyB3aXRoIDAgaWYgZXZlcnl0aGluZyB3ZW50IGZpbmUuCiMjCiMjIEBkZWZncm91cCBBcmdzcGFyc2VVc2FnZSBDYWxsaW5nIHByb2dyYW0gdXNhZ2UgZGVzY3JpcHRpb24gbWVzc2FnZS4KIyMgQGRlZmdyb3VwIEFyZ3NwYXJzZU9wdGlvblNldHRlciBTZXR0aW5nIG9wdGlvbnMgdmFsdWVzLgojIyBAZGVmZ3JvdXAgQXJnc3BhcnNlQ0xJUGFyc2luZyAuLi4KIyMgQGRlZmdyb3VwIEFyZ3NwYXJzZVByb3BlcnR5IE9wdGlvbnMgcHJvcGVydGllcyBoYW5kbGluZy4KIyMgQGRlZmdyb3VwIEFyZ3NwYXJzZVBhcmFtZXRlciBOb24tb3B0aW9uYWwgcG9zaXRpb25uYWwgcGFyYW1ldGVycy4KIyMgQGRlZmdyb3VwIEFyZ3NwYXJzZVV0aWxzIE1pc2MgRnVuY3Rpb25zLgojIyBAZGVmZ3JvdXAgQXJnc3BhcnNlT3B0aW9uVHlwaW5nIC4uLgoKIyBXZSdyZSBub3QgY29tcGF0aWJsZSB3aXRoIG9sZGVyIGJhc2ggdmVyc2lvbnMuCmlmIFtbICIkQkFTSF9WRVJTSU5GTyIgLWx0IDQgXV0KdGhlbgoJcHJpbnRmID4mMiAiVGhpcyByZXF1aXJlcyBiYXNoID49IDQgdG8gcnVuLlxuIgoJcmV0dXJuIDEgMj4vZGV2L251bGwKCWV4aXQgMQpmaQoKaWYgISBjb21tYW5kIC12IGdldG9wdCA+L2Rldi9udWxsIDI+JjEKdGhlbgoJcHJpbnRmID4mMiAiQ2Fubm90IGZpbmQgdGhlIGdldG9wdCBjb21tYW5kLlxuIgoJcmV0dXJuIDEgMj4vZGV2L251bGwKCWV4aXQgMQpmaQoKaWYgZGVjbGFyZSAtcnAgQVJHU1BBUlNFX1ZFUlNJT04gPi9kZXYvbnVsbCAyPiYxCnRoZW4KCSMgYXJnc3BhcnNlIGlzIGFscmVhZHkgbG9hZGVkLgoJcmV0dXJuIDAgMj4vZGV2L251bGwKZmkKCiMjIEB2YXIgQVJHU1BBUlNFX1ZFUlNJT04KIyMgQGJyaWVmIGFyZ3NwYXJzZSB2ZXJzaW9uIG51bWJlcgojIyBAc2hvd2luaXRpYWxpemVyCmRlY2xhcmUgLXIgQVJHU1BBUlNFX1ZFUlNJT049MS44CgojIEVuYWJsZSByZXF1aXJlZCBmZWF0dXJlcwpzaG9wdCAtcyBleHRnbG9iCnNldCArbyBwb3NpeAoKIyMgQGJyaWVmIFRoZSBuYW1lIG9mIHRoZSBwcm9ncmFtIGN1cnJlbnRseSB1c2luZyBhcmdzcGFyc2UuCiMjIEBkZXRhaWxzIEF1dG9tYXRpY2FsbHkgc2V0IGJ5IGFyZ3NwYXJzZSBhdCBsb2FkIHRpbWUsIGl0IGNvbnRhaW5zCiMjIHRoZSBiYXNlbmFtZSAocGF0aC1sZXNzIGJ1dCB3aXRoIGV4dGVuc2lvbiwgaWYgYW55KSBvZiB0aGUgbWFpbgojIyBzY3JpcHQuIFVzZWQgaW50ZXJuYWxseSB0byBwcmludCBlcnJvciBtZXNzYWdlcyBhbmQgYnkKIyMgdXNhZ2UtcmVsYXRlZCBmdW5jdGlvbnMsIGJ1dCBjYW4gYmUgdXNlZCBieSB0aGUgbG9hZGluZyBzY3JpcHQuCiMjIEBoaWRlaW5pdGlhbGl6ZXIKZGVjbGFyZSAtciBhcmdzcGFyc2VfcGdtPSR7MCMjKi99CgoKIyMgQHZhciBTdHJpbmcgX19hcmdzcGFyc2VfZW52aXJvbm1lbnRfdmFyaWFibGVfcHJlZml4CiMjIEBicmllZiBUaGUgcHJlZml4IGZvciBvcHRpb24tc2V0dGluZyBlbnZpcm9ubWVudCB2YXJpYWJsZXMKIyMgQHByaXZhdGUKIyMgQGluZ3JvdXAgQXJnc3BhcnNlT3B0aW9uU2V0dGVyCmRlY2xhcmUgX19hcmdzcGFyc2VfZW52aXJvbm1lbnRfdmFyaWFibGVfcHJlZml4CgoKIyMgQGZuIGFyZ3NwYXJzZV91c2VfZW52aXJvbm1lbnRfdmFyaWFibGVzKCkKIyMgQGJyaWVmIEVuYWJsZSBvcHRpb24gc2V0dGluZyB0aHJvdWdoIGVudmlyb25tZW50IHZhcmlhYmxlcy4KIyMgQGRldGFpbHMKIyMgT25jZSBlbmFibGVkLCBpdCBjYW5ub3QgYmUgZGlzYWJsZWQuCiMjIEBwYXJhbSBwcmVmaXggYW4gZW52aXJvbm1lbnQgdmFyaWFibGUgcHJlZml4CiMjIEBpbmdyb3VwIEFyZ3NwYXJzZU9wdGlvblNldHRlcgphcmdzcGFyc2VfdXNlX2Vudmlyb25tZW50X3ZhcmlhYmxlcygpIHsKCWxvY2FsIHByZWZpeAoJY2FzZSAkIyBpbgoJCTApCgkJCXByZWZpeD0kKGFyZ3NwYXJzZV9vcHRpb25fdG9faWRlbnRpZmllciAiJHthcmdzcGFyc2VfcGdtJS5zaH0iKQoJCQlwcmVmaXg9JHtwcmVmaXheXn0KCQkJOzsKCQkxKQoJCQlwcmVmaXg9JDEKCQkJOzsKCQkqKQoJCQlyZXR1cm4gMQoJZXNhYwoJX19hcmdzcGFyc2VfZW52aXJvbm1lbnRfdmFyaWFibGVfcHJlZml4PSRwcmVmaXgKfQoKCiMjIEBmbiBhcmdzcGFyc2VfYXJlX2Vudmlyb25tZW50X3ZhcmlhYmxlc19lbmFibGVkKCkKIyMgQGJyaWVmIFRlbGwgaWYgb3B0aW9uIHNldHRpbmcgdGhyb3VnaCBlbnZpcm9ubWVudCB2YXJpYWJsZXMgaXMKIyMgZW5hYmxlZCBvciBub3QuCiMjIEBkZXRhaWxzCiMjIEByZXR2YWwgMCBpZiBhcmdzcGFyc2VfcGFyc2Vfb3B0aW9ucyB3b3VsZCBhbHNvIHJldHJpZXZlIG9wdGlvbgojIyB2YWx1ZXMgZnJvbSBlbnZpcm9ubWVudCB2YXJpYWJsZXMuCiMjIEBpbmdyb3VwIEBBcmdzcGFyc2VPcHRpb25TZXR0ZXIKYXJnc3BhcnNlX2FyZV9lbnZpcm9ubWVudF92YXJpYWJsZXNfZW5hYmxlZCgpIHsKCVtbICR7X19hcmdzcGFyc2VfZW52aXJvbm1lbnRfdmFyaWFibGVfcHJlZml4Oi19IF1dCn0KCgojIyBAZm4gYXJnc3BhcnNlX29wdGlvbl9lbnZpcm9ubWVudF92YXJpYWJsZV9uYW1lKCkKIyMgQGJyaWVmIEdpdmUgdGhlIGVudmlyb25tZW50IHZhcmlhYmxlIG5hbWUgbGlua2VkIHRvIGFuIG9wdGlvbgojIyBAZGV0YWlsczAKIyMgUmV0dXJuIHRoZSBuYW1lIG9mIHRoZSBlbnZpcm9ubWVudCB2YXJpYWJsZSBuYW1lIHRoYXQgY2FuIGJlIHVzZWQKIyMgdG8gc2V0IGEgZ2l2ZW4gb3B0aW9uLiBXb3JrcyB3aGV0aGVyIG9wdGlvbiBzZXR0aW5nIHRocm91Z2gKIyMgZW52aXJvbm1lbnQgdmFyaWFibGVzIGlzIGVuYWJsZWQgb3Igbm90LgojIyBAcGFyYW0gb3B0aW9uIGFuIG9wdGlvbiBuYW1lCiMjIEByZXR1cm4gdGhlIGVudmlyb25tZW50IHZhcmlhYmxlIG5hbWUgbGlua2VkIHRvIHRoZSBvcHRpb24KYXJnc3BhcnNlX29wdGlvbl9lbnZpcm9ubWVudF92YXJpYWJsZV9uYW1lKCkgewoJW1sgJCMgLWVxIDEgXV0gfHwgcmV0dXJuIDEKCWxvY2FsIG9wdGlvbj0kMQoJbG9jYWwgaWRlbnRpZmllcj0kKGFyZ3NwYXJzZV9vcHRpb25fdG9faWRlbnRpZmllciAiJG9wdGlvbiIpCglwcmludGYgJXNfJXMgIiRfX2FyZ3NwYXJzZV9lbnZpcm9ubWVudF92YXJpYWJsZV9wcmVmaXgiICIke2lkZW50aWZpZXJeXn0iCn0KCgojIyBAZm4gYXJnc3BhcnNlX29wdGlvbl9lbnZpcm9ubWVudF92YXJpYWJsZSgpCiMjIEBicmllZiBHaXZlIHRoZSBjb250ZW50IG9mIHRoZSBlbnZpcm9ubWVudCB2YXJpYWJsZSB0aGF0IGNhbiBiZQojIyB1c2VkIHRvIHNldCBhIGdpdmVuIG9wdGlvbi4KIyMgQGRldGFpbHMKIyMgRG9lcyBub3QgY2hlY2sgaWYgb3B0aW9uIHNldHRpbmcgdGhyb3VnaCBlbnZpcm9ubWVudCB2YXJpYWJsZSBpcwojIyBlbmFibGVkIG9yIG5vdC4KIyMgQHBhcmFtIG9wdGlvbiBBbiBvcHRpb24gbmFtZQojIyBAcmV0dXJuIFRoZSBjb250ZW50IG9mIHRoZSBlbnZpcm9ubWVudCB2YXJpYWJsZSB0aGF0IG1hdGNoZXMgdGhlCiMjIGdpdmVuIG9wdGlvbi4KIyMgQHJldHZhbCAwIGlmIHRoZSB2YXJpYWJsZSB0aGF0IG1hdGNoZXMgdGhlIGdpdmVuIG9wdGlvbiBhY3R1YWxseQojIyBleGlzdHMgKGV2ZW4gaWYgaXRzIHZhbHVlIGlzIGVtcHR5KQphcmdzcGFyc2Vfb3B0aW9uX2Vudmlyb25tZW50X3ZhcmlhYmxlKCkgewoJW1sgJCMgLWVxIDEgXV0gfHwgcmV0dXJuIDEKCWxvY2FsIG9wdGlvbj0kMQoJbG9jYWwgdmFyPSQoYXJnc3BhcnNlX29wdGlvbl9lbnZpcm9ubWVudF92YXJpYWJsZV9uYW1lICIkb3B0aW9uIikKCWlmIFtbIC12ICR2YXIgXV07IHRoZW4KCQlwcmludGYgJXMgIiR7IXZhcn0iCgkJcmV0dXJuIDAKCWZpCglyZXR1cm4gMQp9CgoKIyMgQGZuIGFyZ3NwYXJzZV9zZXRfb3B0aW9uX2Zyb21fZW52aXJvbm1lbnRfdmFsdWUoKQojIyBAYnJpZWYgR2l2ZSBhIHZhbHVlIHRvIGFuIG9wdGlvbiwgZnJvbSBlbnZpcm9ubWVudCB2YXJpYWJsZSB2YWx1ZS4KIyMgQGRldGFpbHMKIyMgT3B0aW9ucyBjYW4gYmUgc2V0IGZyb20gZW52aXJvbm1lbnQgdmFyaWFibGVzLCBhbmQgaW4gc29tZSBjYXNlcywKIyMgdGhvc2UgdmFsdWVzIGhhdmUgc3BlY2lhbCBtZWFuaW5nczoKIyMgLSAwLCAiZmFsc2UiLCAibm8iIGFuZCB0aGUgZW1wdHkgc3RyaW5nIGFyZSBleHBsaWNpdCB2YWx1ZXMgdG8KIyMgZGlzYWJsZSBhIG5vbi12YWx1ZWQgb3B0aW9uCiMjIC0gKHByb2JhYmx5IG1vcmUgdG8gY29tZSkKIyMgLgojIyBAcGFyYW0gb3B0aW9uIGFuIG9wdGlvbiBuYW1lCiMjIEBwYXJhbSB2YWx1ZSB0aGUgdmFsdWUsIGFzIGZvdW5kIGluIHRoZSBwcm9jZXNzIGVudmlyb25tZW50LCB0byBzZXQKIyMgdGhlIG9wdGlvbiB0by4KYXJnc3BhcnNlX3NldF9vcHRpb25fZnJvbV9lbnZpcm9ubWVudF92YWx1ZSgpIHsKCVtbICQjIC1lcSAyIF1dIHx8IHJldHVybiAxCglsb2NhbCBvcHRpb249JDEKCWxvY2FsIHZhbHVlPSQyCglpZiAhIGFyZ3NwYXJzZV9oYXNfb3B0aW9uX3Byb3BlcnR5ICIkb3B0aW9uIiB2YWx1ZQoJdGhlbgoJCWlmIFtbICR2YWx1ZSAhPSArKDB8ZmFsc2V8bm98IiIpIF1dCgkJdGhlbgoJCQlhcmdzcGFyc2Vfc2V0X29wdGlvbiAiJG9wdGlvbiIKCQlmaQoJIyBUaGVyZSBzaG91bGQgYmUgYW4gZWxpZiBzdGF0ZW1lbnQgaGVyZSwgaWYgd2Ugd2FudCB0byBjb25zaWRlcgoJIyBjdW11bGF0ZWQgb3B0aW9ucyBkaWZmZXJlbnRseS4KCWVsc2UKCQlhcmdzcGFyc2Vfc2V0X29wdGlvbiAiJG9wdGlvbiIgIiR2YWx1ZSIKCWZpCn0KCgojIyBAZm4gX19hcmdzcGFyc2VfcGFyc2Vfb3B0aW9uc19lbnZfYW5kX2RlZmF1bHRzKCkKIyMgQGJyaWVmIHNldCBvcHRpb25zIGZyb20gZW52aXJvbm1lbnQgYW5kIGZyb20gZGVmYXVsdCB2YWx1ZXMuCiMjIEBkZXRhaWxzCiMjIEZvciBldmVyeSBvcHRpb24gdGhhdCBoYXZlIG5vdCBiZWVuIHNldCBmcm9tIGNvbW1hbmQgbGluZSwgbG9vayBmb3IKIyMgYSBtYXRjaGluZyBlbnZpcm9ubWVudCB2YXJpYWJsZSAod2hlbgojIyBhcmdzcGFyc2VfYXJlX2Vudmlyb25tZW50X3ZhcmlhYmxlc19lbmFibGVkKCkgaXMgdHJ1ZSkgYW5kIGFwcGx5CiMjIGRlZmF1bHQgdmFsdWVzIHJpZ2h0IGFmdGVyIGlmIHN0aWxsIGxlZnQgdW5zZXQuCiMjIEBwcml2YXRlCl9fYXJnc3BhcnNlX3BhcnNlX29wdGlvbnNfZW52X2FuZF9kZWZhdWx0cygpIHsKCWxvY2FsIG9wdGlvbiB2YWx1ZQoJZm9yIG9wdGlvbiBpbiAiJHshX19hcmdzcGFyc2Vfb3B0aW9uc19kZXNjcmlwdGlvbnNbQF19IgoJZG8KCQlpZiAhIGFyZ3NwYXJzZV9pc19vcHRpb25fc2V0ICIkb3B0aW9uIgoJCXRoZW4KCQkJaWYgYXJnc3BhcnNlX2FyZV9lbnZpcm9ubWVudF92YXJpYWJsZXNfZW5hYmxlZCAmJgoJCQkJCXZhbHVlPSQoYXJnc3BhcnNlX29wdGlvbl9lbnZpcm9ubWVudF92YXJpYWJsZSAiJG9wdGlvbiIpCgkJCXRoZW4KCQkJCWFyZ3NwYXJzZV9zZXRfb3B0aW9uX2Zyb21fZW52aXJvbm1lbnRfdmFsdWUgIiRvcHRpb24iICIkdmFsdWUiCgkJCWVsaWYgX19hcmdzcGFyc2VfaGFzX2FycmF5X2l0ZW0gXAoJCQkJCSBfX2FyZ3NwYXJzZV9vcHRpb25zX2RlZmF1bHRfdmFsdWVzICIkb3B0aW9uIgoJCQl0aGVuCgkJCQkgYXJnc3BhcnNlX3NldF9vcHRpb24gIiRvcHRpb24iIFwKCQkJCQkiJHtfX2FyZ3NwYXJzZV9vcHRpb25zX2RlZmF1bHRfdmFsdWVzWyRvcHRpb25dfSIKCQkJZmkKCQlmaQoJZG9uZQp9CgoKIyMgQGZuIF9fYXJnc3BhcnNlX2luZGV4X29mKCkKIyMgQHBhcmFtIHZhbHVlIGEgdmFsdWUKIyMgQHBhcmFtIHZhbHVlcy4uLiBhcnJheSB2YWx1ZXMKIyMgQGJyaWVmIFRlbGxzIGlmIGEgdmFsdWUgaXMgZm91bmQgaW4gYSBzZXQgb2Ygb3RoZXIgdmFsdWVzLgojIyBAZGV0YWlscyBMb29rIGZvciBAYSB2YWx1ZSBhbmQgcHJpbnQgaXRzIHBvc2l0aW9uIGluIHRoZSBAYSB2YWx1ZXMKIyMgc2V0LiBSZXR1cm4gZmFsc2UgaWYgaXQgY2FuIG5vdCBiZSBmb3VuZC4KIyMgQHJldHZhbCAwIGlmIEBhIHZhbHVlIGlzIGFtb25nc3QgQGEgdmFsdWVzCiMjIEByZXR2YWwgMSBpZiBAYSB2YWx1ZSBpcyBub3QgZm91bmQuCiMjIEBpbmdyb3VwIEFyZ3NwYXJzZVV0aWxzCl9fYXJnc3BhcnNlX2luZGV4X29mKCkgewoJW1sgJCMgLWdlIDIgXV0gfHwgcmV0dXJuIDEKCWxvY2FsIGtleT0kMSA7IHNoaWZ0Cglsb2NhbCBpbmRleD0wCglsb2NhbCBlbGVtCglmb3IgZWxlbSBpbiAiJEAiCglkbwoJCWlmIFtbICIka2V5IiA9ICIkZWxlbSIgXV0KCQl0aGVuCgkJCXByaW50ZiAlcyAiJGluZGV4IgoJCQlyZXR1cm4gMAoJCWZpCgkJOiAkKChpbmRleCsrKSkKCWRvbmUKCXJldHVybiAxCn0KCiMjIEBmbiBfX2FyZ3NwYXJzZV9qb2luX2FycmF5KCkKIyMgQHBhcmFtIGMgYSBzaW5nbGUgY2hhcgojIyBAcGFyYW0gc3RyaW5ncy4uLiBzdHJpbmdzIHRvIGpvaW4KIyMgQGJyaWVmIGpvaW4gbXVsdGlwbGUgc3RyaW5ncyBieSBhIGNoYXIuCiMjIEBkZXRhaWxzIExpa2UgdGhlICdzdHIuam9pbicgc3RyaW5nIG1ldGhvZCBpbiBweXRob24sIGpvaW4gbXVsdGlwbGUKIyMgc3RyaW5ncyBieSBhIGNoYXIuIE9ubHkgd29yayB3aXRoIGEgc2luZ2xlIGNoYXIsIHRob3VnaC4KIyMgQHJldHZhbCAxIGlmIGZpcnN0IHBhcmFtZXRlciBpcyBpbnZhbGlkLgojIyBAcmV0dmFsIDAgZWxzZS4KIyMgQGluZ3JvdXAgQXJnc3BhcnNlVXRpbHMKX19hcmdzcGFyc2Vfam9pbl9hcnJheSgpIHsKCVtbICQjIC1nZSAxICYmICQxID0gPyBdXSB8fCByZXR1cm4gMQoJbG9jYWwgSUZTPSIkMSRJRlMiCglzaGlmdAoJcHJpbnRmICVzICIkKiIKfQoKCiMgQHByaXZhdGUKIyBAZm4gX19hcmdzcGFyc2VfbWF4X2xlbmd0aCgpCiMgQGRldGFpbHMgUHJpbnRzIHRoZSBsZW5ndGggb2YgdGhlIGxvbmdlc3QgYXJndW1lbnQgX29yXyA1MC4KIyBAYnJpZWYgSW50ZXJuYWwgdXNlLgojIEBwYXJhbSBzdHJpbmcuLi4gYSBsaXN0IG9mIHN0cmluZ3MKIyBAcmV0dXJuIDAKX19hcmdzcGFyc2VfbWF4X2xlbmd0aCgpIHsKCWxvY2FsIG1heD01MAoJc2hpZnQKCWxvY2FsIG1heF9sZW5ndGg9MCBzdHIKCWZvciBzdHIgaW4gIiRAIgoJZG8KCQltYXhfbGVuZ3RoPSQoKG1heF9sZW5ndGg+JHsjc3RyfT9tYXhfbGVuZ3RoOiR7I3N0cn0pKQoJZG9uZQoJcHJpbnRmICVkICIkKChtYXhfbGVuZ3RoPm1heD9tYXg6bWF4X2xlbmd0aCkpIgp9CgoKIyMgQGZuIF9fYXJnc3BhcnNlX2lzX2FycmF5X2RlY2xhcmVkKCkKIyMgQHBhcmFtIG5hbWUgQSBwb3RlbnRpYWwgYXJyYXkgbmFtZQojIyBAcmV0dmFsIDAgaWYgYW4gYXJyYXkgbmFtZWQgYWZ0ZXIgdGhlIHBhcmFtZXRlciBkb2VzIGV4aXN0CiMjIEBpbmdyb3VwIEFyZ3NwYXJzZVV0aWxzCl9fYXJnc3BhcnNlX2lzX2FycmF5X2RlY2xhcmVkKCkgewoJW1sgJCMgLWVxIDEgXV0gfHwgcmV0dXJuIDEKCWxvY2FsIGFycmF5X25hbWU9JDEKCVtbICIkKGRlY2xhcmUgLXAgIiRhcnJheV9uYW1lIiAyPi9kZXYvbnVsbCkiID0gXAoJCSJkZWNsYXJlIC0iW2FBXSIgJGFycmF5X25hbWU9IiogXV0KfQoKCiMjIEBmbiBfX2FyZ3NwYXJzZV9oYXNfYXJyYXlfaXRlbSgpCiMjIEBwYXJhbSBhcnJheV9uYW1lIGFuIGFycmF5IG5hbWUuCiMjIEBwYXJhbSBpdGVtIGFuIGl0ZW0ga2V5LgojIyBAcmV0dmFsIDAgaWYgYW4gYXJyYXkgaGFzIGJlZW4gYWxyZWFkeSBkZWNsYXJlZCBieSB0aGUgbmFtZSBvZgojIyB0aGUgcGFyYW1ldGVyIEFORCBpZiBzYWlkIGFycmF5IGhvbGRzIGdpdmVuIGtleS4KIyMgQGluZ3JvdXAgQXJnc3BhcnNlVXRpbHMKX19hcmdzcGFyc2VfaGFzX2FycmF5X2l0ZW0oKSB7CglbWyAkIyA9IFsxMl0gXV0gfHwgcmV0dXJuIDEKCWxvY2FsIGFycmF5X25hbWU9JDEKCWxvY2FsIGluZGV4PSR7MjotQH0KCWxvY2FsIHZhcj0iJGFycmF5X25hbWVbJGluZGV4XSIKCSgKCQlzZXQgK28gbm91bnNldAoJCVtbICR7IXZhcitzZXR9ID0gc2V0IF1dCgkpCn0KCgojIyBAZm4gYXJnc3BhcnNlX29wdGlvbl90b19pZGVudGlmaWVyKCkKIyMgQGJyaWVmIEdpdmUgdGhlIGlkZW50aWZpZXIgbmFtZSBhc3NvY2lhdGVkIHRvIGFuIG9wdGlvbi4KIyMgQGRldGFpbHMgVHJhbnNmb3JtcyBhbmQgcHJpbnRzIGFuIG9wdGlvbiBuYW1lIGludG8gYSBzdHJpbmcgd2hpY2gKIyMgc3VpdGFibGUgdG8gYmUgcGFydCBvZiBhIGZ1bmN0aW9uIG9yIGEgdmFyaWFibGUgbmFtZS4KIyMgQHBhcmFtIG9wdGlvbiBhbiBvcHRpb24gbmFtZS4KIyMgQGluZ3JvdXAgQXJnc3BhcnNlVXRpbHMKYXJnc3BhcnNlX29wdGlvbl90b19pZGVudGlmaWVyKCkgewoJW1sgJCMgLWVxIDEgXV0gfHwgcmV0dXJuIDEKCWxvY2FsIG9wdGlvbj0kMQoJcHJpbnRmICVzICIke29wdGlvbi8vLS9ffSIKfQoKCiMjIEBmbiBfX2FyZ3NwYXJzZV92YWx1ZXNfYXJyYXlfaWRlbnRpZmllcigpCiMjIEBwcml2YXRlCiMjIEBicmllZiBQcmludHMgdGhlIG5hbWUgb2YgdGhlIGFycmF5IGNvbnRhaW5pbmcgYWxsIHVzZXItZGVjbGFyZWQKIyMgYWNjZXB0YWJsZSB2YWx1ZXMgZm9yIGFuIG9wdGlvbi4KIyMgQGRldGFpbHMgZnJvbSAib3B0IiBvciAib3B0LW5hbWUiIHN0cmluZywgcHJpbnRzCiMjICJvcHRpb25fb3B0X3ZhbHVlc1tAXSIgb3IgIm9wdGlvbl9vcHRfbmFtZV92YWx1ZXNbQF0iLCB1bmxlc3MgYXJyYXkKIyMgaXMgbm90IGRlY2xhcmVkLCBpbiB3aGljaCBjYXNlIGZ1bmN0aW9uIHdpbGwgcmV0dXJuIGFuIGVycm9yLgojIyBAcGFyYW0gb3B0aW9uIGFuIG9wdGlvbiBuYW1lLgojIyBAcmV0dmFsIDEgaWYgYXJyYXkgaGFzIG5vdCBiZWVuIGRlY2xhcmVkCiMjIEByZXR2YWwgMCBlbHNlLiBBcnJheSBuYW1lIHdpbGwgYmUgd3JpdHRlbiB0byBzdGRvdXQuCiMjIEBpbmdyb3VwIEFyZ3NwYXJzZVV0aWxzCl9fYXJnc3BhcnNlX3ZhbHVlc19hcnJheV9pZGVudGlmaWVyKCkgewoJbG9jYWwgb3B0aW9uPSQxCglsb2NhbCBhcnJheT0ib3B0aW9uXyQoYXJnc3BhcnNlX29wdGlvbl90b19pZGVudGlmaWVyICIkb3B0aW9uIilfdmFsdWVzIgoJX19hcmdzcGFyc2VfaXNfYXJyYXlfZGVjbGFyZWQgIiRhcnJheSIgfHwgcmV0dXJuIDEKCXByaW50ZiAlcydbQF0nICIkYXJyYXkiCn0KCgojIyBAYnJpZWYgSW50ZXJuYWwgdXNlIG9ubHkuCiMjIEBkZXRhaWxzIEFuIGFzc29jaWF0aXZlIGFycmF5IHdoZXJlIG9wdGlvbnMgZGVmYXVsdCB2YWx1ZXMgYXJlCiMjIHN0b3JlZCBhcyBzb29uIGFzIHRoZSAnZGVmYXVsdDonIHByb3BlcnR5IGlzIHNldC4KIyMgQGluZ3JvdXAgQXJnc3BhcnNlUHJvcGVydHkKZGVjbGFyZSAtQSBfX2FyZ3NwYXJzZV9vcHRpb25zX2RlZmF1bHRfdmFsdWVzPSgpCgoKIyMgQHZhciBBc3NvY2lhdGl2ZUFycmF5IF9fYXJnc3BhcnNlX29wdGlvbnNfcHJvcGVydGllcwojIyBAcHJpdmF0ZQojIyBAYnJpZWYgSW50ZXJuYWwgdXNlIG9ubHkuCiMjIEBpbmdyb3VwIEFyZ3NwYXJzZVByb3BlcnR5CmRlY2xhcmUgLUEgX19hcmdzcGFyc2Vfb3B0aW9uc19wcm9wZXJ0aWVzPSgpCgoKIyBBc3NvY2lhdGlvbiBzaG9ydCBvcHRpb24gLT4gbG9uZyBvcHRpb24uCiMjIEB2YXIgQXNzb2NpYXRpdmVBcnJheSBfX2FyZ3NwYXJzZV9zaG9ydF9vcHRpb25zCiMjIEBwcml2YXRlCiMjIEBicmllZiBJbnRlcm5hbCB1c2Ugb25seS4KZGVjbGFyZSAtQSBfX2FyZ3NwYXJzZV9zaG9ydF9vcHRpb25zPSgpCgoKIyBAZm4gX19hcmdzcGFyc2Vfb3B0c3RyaW5nX2hhc19zaG9ydCgpCiMgQGJyaWVmIEludGVybmFsIHVzZSBvbmx5LgojIEBkZXRhaWxzIFByaW50cyB0aGUgc2hvcnQgb3B0aW9uIHN0cmluZyBzdWl0YWJsZSBmb3IgZ2V0b3B0IGNvbW1hbmQKIyBsaW5lLgojIEBwYXJhbSBvcHRzdHJpbmcgYW4gb3B0c3RyaW5nCiMgQHJldHVybiBub24temVybyBpZiBnaXZlbiBvcHRzdHJpbmcgZG9lc250IGhhdmUgYW55IHNob3J0IG9wdGlvbgojIGVxdWl2YWxlbnQuCl9fYXJnc3BhcnNlX29wdHN0cmluZ19oYXNfc2hvcnQoKSB7CglbWyAkIyAtZXEgMSBdXSB8fCByZXR1cm4gMQoJbG9jYWwgb3B0c3RyaW5nPSQxCglpZiBbWyAiJG9wdHN0cmluZyIgPX4gLio9KC4pLiogXV0KCXRoZW4KCQlwcmludGYgJWMgIiR7QkFTSF9SRU1BVENIWzFdfSIKCQlyZXR1cm4gMAoJZmkKCXJldHVybiAxCn0KCgojIyBAZm4gYXJnc3BhcnNlX3NldF9vcHRpb25fcHJvcGVydHkoKQojIyBAYnJpZWYgRW5hYmxlIGEgcHJvcGVydHkgdG8gYSBsaXN0IG9mIG9wdGlvbnMuCiMjIEBwYXJhbSBwcm9wZXJ0eSBhIHByb3BlcnR5IG5hbWUuCiMjIEBwYXJhbSBvcHRpb24uLi4gb3B0aW9uIG5hbWVzLgojIyBAcmV0dXJuIG5vbi16ZXJvIGlmIHByb3BlcnR5IGlzIG5vdCBzdXBwb3J0ZWQuCiMjIEBpbmdyb3VwIEFyZ3NwYXJzZVByb3BlcnR5CmFyZ3NwYXJzZV9zZXRfb3B0aW9uX3Byb3BlcnR5KCkgewoJW1sgJCMgLWdlIDIgXV0gfHwgcmV0dXJuIDEKCWxvY2FsIHByb3BlcnR5PSQxCglzaGlmdAoJbG9jYWwgb3B0aW9uIHAgc2hvcnQKCWZvciBvcHRpb24gaW4gIiRAIgoJZG8KCQljYXNlICIkcHJvcGVydHkiIGluCgkJCWN1bXVsYXRpdmV8Y3VtdWxhdGl2ZXNldCkKCQkJCWFyZ3NwYXJzZV9zZXRfb3B0aW9uX3Byb3BlcnR5IHZhbHVlICIkb3B0aW9uIgoJCQkJOzsmCgkJCXR5cGU6KnxleGNsdWRlOip8YWxpYXM6KnxyZXF1aXJlOiopCgkJCQlpZiBbWyAiJHByb3BlcnR5IiA9fiBeLio6KC4rKSQgXV0KCQkJCXRoZW4KCQkJCQkjIElmIHByb3BlcnR5IGhhcyBhIHZhbHVlLCBjaGVjayBpdHMgZm9ybWF0LCB3ZQoJCQkJCSMgZG9udCB3YW50IGFueSBmdW5ueSBjaGFycy4KCQkJCQlpZiBbWyAiJHtCQVNIX1JFTUFUQ0hbMV19IiA9ICpbKj8hLF0qIF1dCgkJCQkJdGhlbgoJCQkJCQlwcmludGYgPiYyICIlczogJXM6IGludmFsaWQgcHJvcGVydHkgdmFsdWUuXG4iIFwKCQkJCQkJCSIkYXJnc3BhcnNlX3BnbSIgIiR7QkFTSF9SRU1BVENIWzFdfSIKCQkJCQkJcmV0dXJuIDEKCQkJCQlmaQoJCQkJZmkKCQkJCTsmCgkJCW1hbmRhdG9yeXxoaWRkZW58dmFsdWV8Y3VtdWxhdGl2ZXxjdW11bGF0aXZlc2V0KQoJCQkJIyBXZSB1c2UgdGhlIGNvbW1hIGFzIHRoZSBwcm9wZXJ0eSBjaGFyYWN0ZXIgc2VwYXJhdG9yCgkJCQkjIGluIHRoZSBfX2FyZ3NwYXJzZV9vcHRpb25zX3Byb3BlcnRpZXMgYXJyYXkuCgkJCQlwPSR7X19hcmdzcGFyc2Vfb3B0aW9uc19wcm9wZXJ0aWVzWyIkb3B0aW9uIl06LX0KCQkJCV9fYXJnc3BhcnNlX29wdGlvbnNfcHJvcGVydGllc1siJG9wdGlvbiJdPSIke3A6KyRwLH0kcHJvcGVydHkiCgkJCQk7OwoJCQlzaG9ydDo/KQoJCQkJc2hvcnQ9JHtwcm9wZXJ0eSNzaG9ydDp9CgkJCQlpZiBfX2FyZ3NwYXJzZV9oYXNfYXJyYXlfaXRlbSBcCgkJCQkJX19hcmdzcGFyc2Vfc2hvcnRfb3B0aW9ucyAiJHNob3J0IgoJCQkJdGhlbgoJCQkJCXByaW50ZiA+JjIgXAoJCQkJCQkiJXM6ICVzOiBzaG9ydCBvcHRpb24gZm9yICVzIGNvbmZsaWN0cyB3aXRoIGFscmVhZHktY29uZmlndXJlZCBzaG9ydCBvcHRpb24gZm9yICVzLlxuIiBcCgkJCQkJCSIkYXJnc3BhcnNlX3BnbSIgIiRzaG9ydCIgIiRvcHRpb24iIFwKCQkJCQkJIiR7X19hcmdzcGFyc2Vfc2hvcnRfb3B0aW9uc1skc2hvcnRdfSIKCQkJCQlyZXR1cm4gMQoJCQkJZmkKCQkJCV9fYXJnc3BhcnNlX3Nob3J0X29wdGlvbnNbIiRzaG9ydCJdPSRvcHRpb24KCQkJCTs7CgkJCWRlZmF1bHQ6KikKCQkJCSMgVGhlIGRlZmF1bHQgdmFsdWUKCQkJCV9fYXJnc3BhcnNlX29wdGlvbnNfZGVmYXVsdF92YWx1ZXNbIiRvcHRpb24iXT0ke3Byb3BlcnR5I2RlZmF1bHQ6fQoJCQkJOzsKCQkJKikKCQkJCXJldHVybiAxCgkJCQk7OwoJCWVzYWMKCWRvbmUKfQoKIyMgQGZuIGFyZ3NwYXJzZV9oYXNfb3B0aW9uX3Byb3BlcnR5KCkKIyMgQGJyaWVmIERldGVybWluZSBpZiBhbiBvcHRpb24gaGFzIGEgcHJvcGVydHkuCiMjIEBkZXRhaWxzIFJldHVybiBUcnVlIGlmIHByb3BlcnR5IGhhcyBiZWVuIHNldCBmb3IgZ2l2ZW4gb3B0aW9uLCBhbmQKIyMgcHJpbnQgdGhlIHByb3BlcnR5IHZhbHVlLCBpZiBhdmFpbGFibGUuCiMjIEBwYXJhbSBvcHRpb24gYW4gb3B0aW9uIG5hbWUuCiMjIEBwYXJhbSBwcm9wZXJ0eSBhIHByb3BlcnR5IG5hbWUuCiMjIEByZXR2YWwgMCBpZiBvcHRpb24gaGFzIGdpdmVuIHByb3BlcnR5LgojIyBAaW5ncm91cCBBcmdzcGFyc2VQcm9wZXJ0eQphcmdzcGFyc2VfaGFzX29wdGlvbl9wcm9wZXJ0eSgpIHsKCVtbICQjIC1lcSAyIF1dIHx8IHJldHVybiAxCglsb2NhbCBvcHRpb249JDEKCWxvY2FsIHByb3BlcnR5PSQyCglsb2NhbCBwPSR7X19hcmdzcGFyc2Vfb3B0aW9uc19wcm9wZXJ0aWVzWyIkb3B0aW9uIl06LSIifQoKCWlmIFtbICIkcCIgPX4gKF58LissKSIkcHJvcGVydHkiKDooW14sXSspKT8oJHwsLispIF1dCgl0aGVuCgkJcHJpbnRmICVzICIke0JBU0hfUkVNQVRDSFszXX0iCgllbGlmIFtbICRwcm9wZXJ0eSA9IGRlZmF1bHQgJiYgXAoJCSIke19fYXJnc3BhcnNlX29wdGlvbnNfZGVmYXVsdF92YWx1ZXNbJG9wdGlvbl0reWVzfSIgPSB5ZXMgXV0KCXRoZW4KCQkJcHJpbnQgJXMgIiR7X19hcmdzcGFyc2Vfb3B0aW9uc19kZWZhdWx0X3ZhbHVlc1skb3B0aW9uXX0iCgllbHNlCgkJcmV0dXJuIDEKCWZpCn0KCgojIyBAZm4gYXJnc3BhcnNlX3Nob3J0X3RvX2xvbmcoKQojIyBAYnJpZWYKIyMgQHBhcmFtIGNoYXIgYSBzaG9ydCBvcHRpb24gbGV0dGVyCiMjIEByZXR1cm4gaWYgZm91bmQsIHRoZSBsb25nIG9wdGlvbiBuYW1lIG1hdGNoaW5nIGdpdmVuIHNob3J0IG9wdGlvbgojIyBsZXR0ZXIuCmFyZ3NwYXJzZV9zaG9ydF90b19sb25nKCkgewoJW1sgJCMgLWVxIDEgXV0gfHwgcmV0dXJuIDEKCWxvY2FsIGNoYXI9JDEKCWxvY2FsIGxvbmc9JHtfX2FyZ3NwYXJzZV9zaG9ydF9vcHRpb25zWyRjaGFyXX0KCVtbIC1uICIkbG9uZyIgXV0gJiYgcHJpbnRmICVzICIkbG9uZyIKfQoKCiMgVGhpcyBpcyBhbiBhc3NvY2lhdGl2ZSBhcnJheS4gSXQgc2hvdWxkIGNvbnRhaW5zIHJlY29yZHMgb2YgdGhlIGZvcm0KIyAic29tZXRoaW5nIiAtPiAiU29tZSB1c2FnZSBkZXNjcmlwdGlvbiBzdHJpbmciLgojIFRoZSAic29tZXRoaW5nIiBzdHJpbmcgaXMgcmVmZXJyZWQgYXMgdGhlICJvcHRpb24gbmFtZSIgbGF0ZXIgaW4KIyBzb3VyY2UgY29kZSBhbmQgY29tbWVudHMuCiMjIEB2YXIgQXNzb2NpYXRpdmVBcnJheSBfX2FyZ3NwYXJzZV9vcHRpb25zX2Rlc2NyaXB0aW9ucwojIyBAcHJpdmF0ZQojIyBAYnJpZWYgSW50ZXJuYWwgdXNlIG9ubHkuCmRlY2xhcmUgLUEgX19hcmdzcGFyc2Vfb3B0aW9uc19kZXNjcmlwdGlvbnM9KCkKCgojIEBmbiBfX2FyZ3NwYXJzZV9jaGVja19kZWNsYXJhdGlvbl9jb25mbGljdCgpCiMgQGJyaWVmIEludGVybmFsIHVzZS4KIyBAZGV0YWlscyBDaGVjayBpZiBhbiBvcHRpb24gY29uZmxpY3RzIHdpdGggYW5vdGhlciBhbmQsIGlmIGl0IGRvZXMsCiMgcHJpbnRzIHRoZSBjb25mbGljdGVkIG9wdGlvbi4KIyBAcGFyYW0gb3B0aW9uIGFuIG9wdGlvbiBuYW1lCiMgQHJldHVybiBUcnVlIGlmIG9wdGlvbiAqZG9lcyogY29uZmxpY3Qgd2l0aCBhIHByZXZpb3VzbHkgZGVjbGFyZWQKIyBvcHRpb24uCl9fYXJnc3BhcnNlX2NoZWNrX2RlY2xhcmF0aW9uX2NvbmZsaWN0KCkgewoJW1sgJCMgLWVxIDEgXV0gfHwgcmV0dXJuIDEKCWxvY2FsIG9wdGlvbj0kMQoJbG9jYWwgaWRlbnRpZmllcj0kKGFyZ3NwYXJzZV9vcHRpb25fdG9faWRlbnRpZmllciAiJG9wdGlvbiIpCglsb2NhbCAtYSBpZGVudGlmaWVycz0oIiR7IV9fYXJnc3BhcnNlX3RtcF9pZGVudGlmaWVyc1tAXX0iKQoJbG9jYWwgY29uZmxpY3QKCWlmIF9fYXJnc3BhcnNlX2hhc19hcnJheV9pdGVtIGlkZW50aWZpZXJzIEAgJiYgXAoJCSAgIGNvbmZsaWN0PSQoX19hcmdzcGFyc2VfaW5kZXhfb2YgIiRpZGVudGlmaWVyIiAiJHtpZGVudGlmaWVyc1tAXX0iKQoJdGhlbgoJCXByaW50ZiAlcyAiJHtfX2FyZ3NwYXJzZV90bXBfaWRlbnRpZmllcnNbJHtpZGVudGlmaWVyc1skY29uZmxpY3RdfV19IgoJCXJldHVybiAwCglmaQoJX19hcmdzcGFyc2VfdG1wX2lkZW50aWZpZXJzWyIkaWRlbnRpZmllciJdPSRvcHRpb24KCXJldHVybiAxCn0KCgojIyBAZm4gYXJnc3BhcnNlX3VzZV9vcHRpb24oKQojIyBAYnJpZWYgRGVmaW5lIGEgQGIgbmV3IG9wdGlvbi4KIyMgQHBhcmFtIG9wdHN0cmluZyBhbiBvcHRzdHJpbmcuCiMjIEBwYXJhbSBkZXNjcmlwdGlvbiB0aGUgb3B0aW9uIGRlc2NyaXB0aW9uLCBmb3IgdGhlIHVzYWdlKCkgZnVuY3Rpb24uCiMjIEBwYXJhbSBwcm9wZXJ0eS4uLiBhbiBub24tb3JkZXJlZCBsaXN0IG9mIGtleXdvcmRzLiBSZWNvZ25pemVkCiMjIHByb3BlcnR5IGtleXdvcmRzIGFyZToKIyMgICAtIG1hbmRhdG9yeTogbWlzc2luZyBvcHRpb24gd2lsbCB0cmlnZ2VyIHVzYWdlLiBJZiBhIGRlZmF1bHQKIyMgICAgIHZhbHVlIGlzIGdpdmVuLCB0aGUgb3B0aW9uIGlzIGNvbnNpZGVyZWQgYXMgaWYgcHJvdmlkZWQgb24KIyMgICAgIHRoZSBjb21tYW5kIGxpbmUuCiMjICAgLSBoaWRkZW46IG9wdGlvbiB3b250IHNob3cgaW4gZGVmYXVsdCB1c2FnZSBmdW5jdGlvbi4KIyMgICAtIHZhbHVlOiBvcHRpb24gZXhwZWN0cyBhIGZvbGxvd2luZyB2YWx1ZS4KIyMgICAtIHNob3J0OmM6IG9wdGlvbiBoYXMgYSBzaW5nbGUtbGV0dGVyZWQgKGMpIGVxdWl2YWxlbnQuCiMjICAgLSBleGNsdWRlOiJvcHRpb24xIFsgb3B0aW9uMiAuLi4gXSIgb3B0aW9uIGlzIG5vdAojIyAgIGNvbXBhdGlibGUgd2l0aCBvdGhlciBvcHRpb25zIG9wdGlvbjEsIG9wdGlvbjIuLi4KIyMgICAtIGN1bXVsYXRpdmUKIyMgICAtIGN1bXVsYXRpdmVzZXQKIyMgICAtIHR5cGU6c29tZXR5cGUKIyMgICAtIFRoZSBAYiBsYXN0IG5vbi1rZXl3b3JkIHBhcmFtZXRlciB3aWxsIGJlIGNvbnNpZGVyZWQgYXMgdGhlCiMjICAgICBkZWZhdWx0IHZhbHVlIGZvciB0aGUgb3B0aW9uLiBBbGwgb3RoZXIgcGFyYW1ldGVycyBhbmQKIyMgICAgIHZhbHVlcyB3aWxsIGJlIGlnbm9yZWQuIC0gbWlnaHQgYmUgYnJva2VuIC8gb2Jzb2xldGUgYW5kIGJyb2tlbgojIyBAcmV0dmFsIDAgaWYgbm8gZXJyb3IgaXMgZW5jb3VudGVyZWQuCiMjIEByZXR2YWwgMiBpZiBvcHRpb24gbmFtZSBpcyBiYWQgKGEgbWVzc2FnZSB3aWxsIGJlIHByaW50ZWQpCiMjIEByZXR2YWwgMyBpZiBvcHRpb24gbmFtZSBjb25mbGljdHMgd2l0aCBhbm90aGVyIG9wdGlvbiAoYSBtZXNzYWdlCiMjIHdpbGwgYmUgcHJpbnRlZCkKIyMgQHJldHZhbCA0IGlmIGEgd3JvbmcgcHJvcGVydHkgbmFtZSBpcyBwcm92aWRlZC4gKGEgbWVzc2FnZSB3aWxsIGJlCiMjIHByaW50ZWQpCmFyZ3NwYXJzZV91c2Vfb3B0aW9uKCkgewoJW1sgJCMgLWdlIDIgXV0gfHwgcmV0dXJuIDEKCWxvY2FsIG9wdHN0cmluZz0kMQoJbG9jYWwgZGVzY3JpcHRpb249JDIKCXNoaWZ0IDIKCWxvY2FsIGxvbmcgc2hvcnQgY29uZmxpY3QKCSMgY29uZmlndXJlIHNob3J0IG9wdGlvbi4KCWlmIHNob3J0PSQoX19hcmdzcGFyc2Vfb3B0c3RyaW5nX2hhc19zaG9ydCAiJG9wdHN0cmluZyIpCgl0aGVuCgkJc2V0IC0tICJzaG9ydDokc2hvcnQiICIkQCIKCQlvcHRzdHJpbmc9JHtvcHRzdHJpbmcvPS99CglmaQoJIyAtLSRvcHRzdHJpbmcgZXhwZWN0IGFuIGFyZ3VtZW50LgoJaWYgW1sgIiRvcHRzdHJpbmciID0gKjogXV0KCXRoZW4KCQlzZXQgLS0gdmFsdWUgIiRAIgoJCWxvbmc9JHtvcHRzdHJpbmclOn0KCWVsc2UKCQlsb25nPSRvcHRzdHJpbmcKCWZpCgoJaWYgW1sgIiRsb25nIiA9ICpbIS0wLTlhLXpBLVpfXSogXV0KCXRoZW4KCQlwcmludGYgPiYyICIlczogJXM6IGJhZCBvcHRpb24gbmFtZS5cbiIgIiRhcmdzcGFyc2VfcGdtIiAiJGxvbmciCgkJcmV0dXJuIDIKCWZpCgoJaWYgY29uZmxpY3Q9JChfX2FyZ3NwYXJzZV9jaGVja19kZWNsYXJhdGlvbl9jb25mbGljdCAiJGxvbmciKQoJdGhlbgoJCXByaW50ZiA+JjIgIiVzOiAlczogb3B0aW9uIGNvbmZsaWN0cyB3aXRoIGFscmVhZHktZGVjbGFyZWQgJXMuXG4iIFwKCQkJIiRhcmdzcGFyc2VfcGdtIiAiJGxvbmciICIkY29uZmxpY3QiCgkJcmV0dXJuIDMKCWZpCgoJX19hcmdzcGFyc2Vfb3B0aW9uc19kZXNjcmlwdGlvbnNbIiRsb25nIl09JGRlc2NyaXB0aW9uCgoJIyBBbnkgb3RoZXIgcGFyYW1ldGVyIHRvIHRoaXMgZnVuY3Rpb24gc2hvdWxkIGJlIGEgcHJvcGVydHkuCgl3aGlsZSBbWyAkIyAtbmUgMCBdXQoJZG8KCQlpZiAhIGFyZ3NwYXJzZV9zZXRfb3B0aW9uX3Byb3BlcnR5ICIkMSIgIiRsb25nIgoJCXRoZW4KCQkJcHJpbnRmID4mMiAnJXM6ICVzOiB1bmtub3duIHByb3BlcnR5LlxuJyAiJGFyZ3NwYXJzZV9wZ20iICIkMSIKCQkJcmV0dXJuIDQKCQlmaQoJCXNoaWZ0Cglkb25lCn0KCiMjIEBmbiBhcmdzcGFyc2Vfb3B0aW9uX2Rlc2NyaXB0aW9uKCkKIyMgQGJyaWVmIFByaW50cyB0byBzdGRvdXQgdGhlIGRlc2NyaXB0aW9uIG9mIGdpdmVuIG9wdGlvbi4KIyMgQHBhcmFtIG9wdGlvbiBhbiBvcHRpb24gbmFtZS4KIyMgQHJldHZhbCAwIGlmIGdpdmVuIG9wdGlvbiBoYXMgYmVlbiBwcmV2aW91c2x5IGRlY2xhcmVkLgphcmdzcGFyc2Vfb3B0aW9uX2Rlc2NyaXB0aW9uKCkgewoJW1sgJCMgLWVxIDEgXV0gfHwgcmV0dXJuIDEKCWxvY2FsIG9wdGlvbj0kMQoJW1sgLW4gIiR7X19hcmdzcGFyc2Vfb3B0aW9uc19kZXNjcmlwdGlvbnNbJG9wdGlvbl0reWVzfSIgXV0gJiYgXAoJCXByaW50ZiAlcyAiJHtfX2FyZ3NwYXJzZV9vcHRpb25zX2Rlc2NyaXB0aW9uc1skb3B0aW9uXX0iCn0KCgojIyBAZm4gYXJnc3BhcnNlX2NoZWNrX29wdGlvbl90eXBlKCkKIyMgQGJyaWVmIENoZWNrIGlmIGEgdmFsdWUgbWF0Y2hlcyBhIGdpdmVuIHR5cGUuCiMjIEBkZXRhaWxzIFJldHVybiBUcnVlIGlmIEBhIHZhbHVlIGlzIG9mIHR5cGUgQGEgdHlwZS4KIyMgQHBhcmFtIHR5cGUgQSBjYXNlLWluc2Vuc2l0aXZlIHR5cGUgbmFtZS4KIyMgQHBhcmFtIHZhbHVlIGEgdmFsdWUgdG8gY2hlY2suCiMjIEByZXR2YWwgMCBpZiB0aGUgdmFsdWUgbWF0Y2hlcyB0aGUgZ2l2ZW4gdHlwZSBmb3JtYXQuCiMjIEBpbmdyb3VwIEFyZ3NwYXJzZU9wdGlvblR5cGluZwphcmdzcGFyc2VfY2hlY2tfb3B0aW9uX3R5cGUoKSB7CglbWyAkIyAtZXEgMiBdXSB8fCByZXR1cm4gMQoJbG9jYWwgb3B0aW9uX3R5cGU9JHsxLCx9Cglsb2NhbCB2YWx1ZT0kMgoJbG9jYWwgdAoJY2FzZSAiJG9wdGlvbl90eXBlIiBpbgoJCWZpbGV8ZGlyZWN0b3J5fHBpcGV8dGVybWluYWwpCgkJCSMgW1sgd29udCBhY2NlcHQgdGhlIC0kdmFyIGFzIGFuIG9wZXJhdG9yLgoJCQlbIC0iJHtvcHRpb25fdHlwZTowOjF9IiAiJHZhbHVlIiBdCgkJCTs7CgkJc29ja2V0fGxpbmspCgkJCXQ9JHtvcHRpb25fdHlwZTowOjF9CgkJCVsgLSIke3ReXn0iICIkdmFsdWUiIF0KCQkJOzsKCQljaGFyKQoJCQlbWyAiJHZhbHVlIiA9ID8gXV0KCQkJOzsKCQl1bnNpZ25lZGludHx1aW50KQoJCQlbWyAiJHZhbHVlIiA9ICsoWzAtOV0pIF1dCgkJCTs7CgkJaW50ZWdlcnxpbnQpCgkJCVtbICIkdmFsdWUiID0gPygtKSsoWzAtOV0pIF1dCgkJCTs7CgkJaGV4YSkKCQkJW1sgIiR2YWx1ZSIgPSA/KDB4KSsoW2EtZkEtRjAtOV0pIF1dCgkJCTs7CgkJaXB2NCkKCQkJIyBSZWd1bGFyIGV4cHJlc3Npb24gZm9yIGlwdjQgYW5kIGlwdjYgaGF2ZSBiZWVuIGZvdW5kIG9uCgkJCSMgaHR0cDovL3d3dy5kLXNpdGVzLmNvbS8yMDA4LzEwLzA5L3JlZ2V4LWlwdjQtZXQtaXB2Ni8KCQkJW1sgIiR2YWx1ZSIgPX4gXigyNVswLTVdfDJbMC00XVswLTldfFswMV0/WzAtOV1bMC05XT8pLigyNVswLTVdfDJbMC00XVswLTldfFswMV0/WzAtOV1bMC05XT8pLigyNVswLTVdfDJbMC00XVswLTldfFswMV0/WzAtOV1bMC05XT8pLigyNVswLTVdfDJbMC00XVswLTldfFswMV0/WzAtOV1bMC05XT8pJCBdXQoJCQk7OwoJCWlwdjYpCgkJCVtbICIkdmFsdWUiID1+IF4oKChbMC05QS1GYS1mXXsxLDR9Oil7N31bMC05QS1GYS1mXXsxLDR9KXwoKFswLTlBLUZhLWZdezEsNH06KXs2fTpbMC05QS1GYS1mXXsxLDR9KXwoKFswLTlBLUZhLWZdezEsNH06KXs1fTooWzAtOUEtRmEtZl17MSw0fTopP1swLTlBLUZhLWZdezEsNH0pfCgoWzAtOUEtRmEtZl17MSw0fTopezR9OihbMC05QS1GYS1mXXsxLDR9Oil7MCwyfVswLTlBLUZhLWZdezEsNH0pfCgoWzAtOUEtRmEtZl17MSw0fTopezN9OihbMC05QS1GYS1mXXsxLDR9Oil7MCwzfVswLTlBLUZhLWZdezEsNH0pfCgoWzAtOUEtRmEtZl17MSw0fTopezJ9OihbMC05QS1GYS1mXXsxLDR9Oil7MCw0fVswLTlBLUZhLWZdezEsNH0pfCgoWzAtOUEtRmEtZl17MSw0fTopezZ9KChiKCgyNVswLTVdKXwoMWR7Mn0pfCgyWzAtNF1kKXwoZHsxLDJ9KSliKS4pezN9KGIoKDI1WzAtNV0pfCgxZHsyfSl8KDJbMC00XWQpfChkezEsMn0pKWIpKXwoKFswLTlBLUZhLWZdezEsNH06KXswLDV9OigoYigoMjVbMC01XSl8KDFkezJ9KXwoMlswLTRdZCl8KGR7MSwyfSkpYikuKXszfShiKCgyNVswLTVdKXwoMWR7Mn0pfCgyWzAtNF1kKXwoZHsxLDJ9KSliKSl8KDo6KFswLTlBLUZhLWZdezEsNH06KXswLDV9KChiKCgyNVswLTVdKXwoMWR7Mn0pfCgyWzAtNF1kKXwoZHsxLDJ9KSliKS4pezN9KGIoKDI1WzAtNV0pfCgxZHsyfSl8KDJbMC00XWQpfChkezEsMn0pKWIpKXwoWzAtOUEtRmEtZl17MSw0fTo6KFswLTlBLUZhLWZdezEsNH06KXswLDV9WzAtOUEtRmEtZl17MSw0fSl8KDo6KFswLTlBLUZhLWZdezEsNH06KXswLDZ9WzAtOUEtRmEtZl17MSw0fSl8KChbMC05QS1GYS1mXXsxLDR9Oil7MSw3fTopKSQgXV0KCQkJOzsKCQlpcCkKCQkJIyBHZW5lcmljIElQIGFkZHJlc3MuCgkJCWFyZ3NwYXJzZV9jaGVja19vcHRpb25fdHlwZSBpcHY0ICIkdmFsdWUiIHx8IFwKCQkJCWFyZ3NwYXJzZV9jaGVja19vcHRpb25fdHlwZSBpcHY2ICIkdmFsdWUiCgkJCTs7CgkJaG9zdG5hbWUpCgkJCSMgY2hlY2sgaWYgdmFsdWUgcmVzb2x2IGFzIGFuIElQdjQgb3IgSVB2NiBhZGRyZXNzLgoJCQlob3N0IC10IGEgIiR2YWx1ZSIgPi9kZXYvbnVsbCAyPiYxIHx8IFwKCQkJCWhvc3QgLXQgYWFhYSAiJHZhbHVlIiA+L2Rldi9udWxsIDI+JjEKCQkJOzsKCQlob3N0KQoJCQkjIEFuIGhvc3RuYW1lIG9yIGFuIElQIGFkZHJlc3MuCgkJCWFyZ3NwYXJzZV9jaGVja19vcHRpb25fdHlwZSBob3N0bmFtZSAiJHZhbHVlIiB8fCBcCgkJCQlhcmdzcGFyc2VfY2hlY2tfb3B0aW9uX3R5cGUgaXB2NCAiJHZhbHVlIiB8fCBcCgkJCQlhcmdzcGFyc2VfY2hlY2tfb3B0aW9uX3R5cGUgaXB2NiAiJHZhbHVlIgoJCQk7OwoJCXBvcnRudW1iZXIpCgkJCWFyZ3NwYXJzZV9jaGVja19vcHRpb25fdHlwZSB1aW50ICIkdmFsdWUiICYmIFwKCQkJCVtbICIkdmFsdWUiIC1ndCAwICYmICIkdmFsdWUiIC1sZSA2NTUzNiBdXQoJCQk7OwoJCXBvcnQpCgkJCSMgUG9ydCBudW1iZXIgb3Igc2VydmljZS4KCQkJYXJnc3BhcnNlX2NoZWNrX29wdGlvbl90eXBlIHBvcnRudW1iZXIgIiR2YWx1ZSIgfHwgXAoJCQkJZ2V0ZW50IHNlcnZpY2VzICIkdmFsdWUiID4vZGV2L251bGwgMj4mMQoJCQk7OwoJCXVzZXJuYW1lKQoJCQlnZXRlbnQgcGFzc3dkICIkdmFsdWUiID4vZGV2L251bGwgMj4mMQoJCQk7OwoJCWdyb3VwKQoJCQlnZXRlbnQgZ3JvdXAgIiR2YWx1ZSIgPi9kZXYvbnVsbCAyPiYxCgkJCTs7CgkJZGF0ZSkKCQkJZGF0ZSAtLWRhdGUgIiR2YWx1ZSIgID4vZGV2L251bGwgMj4mMQoJCQk7OwoJCSopCgkJCSMgSW52b2tlIHVzZXItZGVmaW5lZCB0eXBlLWNoZWNraW5nIGZ1bmN0aW9uIGlmIGF2YWlsYWJsZS4KCQkJaWYgISBkZWNsYXJlIC1mICJjaGVja19vcHRpb25fdHlwZV8kb3B0aW9uX3R5cGUiID4vZGV2L251bGwKCQkJdGhlbgoJCQkJcHJpbnRmID4mMiBcCgkJCQkJIiVzOiAlczogdHlwZSBoYXMgbm8gdmFsaWRhdGlvbiBmdW5jdGlvbi4gVGhpcyBpcyBhIGJ1Zy5cbiIgXAoJCQkJCSIkYXJnc3BhcnNlX3BnbSIgIiRvcHRpb25fdHlwZSIKCQkJCXJldHVybiAyCgkJCWZpCgkJCSJjaGVja19vcHRpb25fdHlwZV8kb3B0aW9uX3R5cGUiICIkdmFsdWUiCgkJCTs7Cgllc2FjCn0KCgojIFRoZSB1c2FnZS1yZWxhdGVkIGZ1bmN0aW9ucy4KCiMjIEB2YXIgQXJyYXkgX19hcmdzcGFyc2VfcGFyYW1ldGVyc19kZXNjcmlwdGlvbgojIyBAcHJpdmF0ZQojIyBAYnJpZWYgSW50ZXJuYWwgdXNlIG9ubHkuCiMjIEBpbmdyb3VwIEFyZ3NwYXJzZVVzYWdlCiMgQGRldGFpbHMgVXNlZCBieSBhcmdzcGFyc2VfZGVzY3JpYmVfcGFyYW1ldGVycygpIHRvIHN0b3JlCiMgbm9uLW9wdGlvbiBwb3NpdGlvbm5hbCBwYXJhbWV0ZXJzIHNob3J0IGRlc2NyaXB0aW9ucyBhbmQgYnkKIyBhcmdzcGFyc2VfdXNhZ2Vfc2hvcnQoKSB0byBwcmludCB0aGVtIHRvIGVuZC11c2Vycy4KZGVjbGFyZSAtYSBfX2FyZ3NwYXJzZV9wYXJhbWV0ZXJzX2Rlc2NyaXB0aW9uCgoKX19hcmdzcGFyc2VfdXNhZ2Vfc2hvcnRfbGluZV9tYW5hZ2VtZW50KCkgewoJW1sgJCMgLWVxIDEgXV0gfHwgcmV0dXJuIDEKCWxvY2FsIG5leHRfdG9rZW49JDEKCWxvY2FsIG1heF9sZW5ndGg9NzgKCWxvY2FsIGJpZ2dlcl9saW5lCgliaWdnZXJfbGluZT0iJGN1cnJlbnRfbGluZSAkbmV4dF90b2tlbiIKCWlmIFtbICIkeyNiaWdnZXJfbGluZX0iIC1ndCAiJG1heF9sZW5ndGgiIF1dCgl0aGVuCgkJcHJpbnRmIC0tICclcyBcXFxuJyAiJGN1cnJlbnRfbGluZSIKCQlwcmludGYgLXYgY3VycmVudF9saW5lICJcdCVzIiAiJG5leHRfdG9rZW4iCgllbHNlCgkJY3VycmVudF9saW5lPSRiaWdnZXJfbGluZQoJZmkKfQoKCiMjIEBmbiBhcmdzcGFyc2VfdXNhZ2Vfc2hvcnQoKQojIyBAYnJpZWYgUHJpbnQgYSBzaG9ydCBkZXNjcmlwdGlvbiBvZiB0aGUgcHJvZ3JhbSBzeW50YXguCiMjIEBkZXRhaWxzIEdlbmVyYXRlIGFuZCBwcmludCB0aGUgInNob3J0IiBkZXNjcmlwdGlvbiBvZiB0aGUgcHJvZ3JhbQojIyB1c2FnZS4KIyMgQGluZ3JvdXAgQXJnc3BhcnNlVXNhZ2UKYXJnc3BhcnNlX3VzYWdlX3Nob3J0KCkgewoJbG9jYWwgb3B0aW9uIHZhbHVlcyBjdXJyZW50X2xpbmUgY3VycmVudF9vcHRpb24gcGFyYW0KCWxvY2FsIG1heF9sZW5ndGg9NzgKCWN1cnJlbnRfbGluZT0kYXJnc3BhcnNlX3BnbQoJZm9yIG9wdGlvbiBpbiAiJHshX19hcmdzcGFyc2Vfb3B0aW9uc19kZXNjcmlwdGlvbnNbQF19IgoJZG8KCQlpZiBhcmdzcGFyc2VfaGFzX29wdGlvbl9wcm9wZXJ0eSAiJG9wdGlvbiIgaGlkZGVuCgkJdGhlbgoJCQljb250aW51ZQoJCWZpCgkJY3VycmVudF9vcHRpb249Ii0tJG9wdGlvbiIKCQlpZiBhcmdzcGFyc2VfaGFzX29wdGlvbl9wcm9wZXJ0eSAiJG9wdGlvbiIgdmFsdWUKCQl0aGVuCgkJCWlmIHZhbHVlcz0kKF9fYXJnc3BhcnNlX3ZhbHVlc19hcnJheV9pZGVudGlmaWVyICIkb3B0aW9uIikKCQkJdGhlbgoJCQkJY3VycmVudF9vcHRpb249IiRjdXJyZW50X29wdGlvbiA8JCgKCQkJCQlfX2FyZ3NwYXJzZV9qb2luX2FycmF5ICd8JyAiJHshdmFsdWVzfSIpPiIKCQkJZWxzZQoJCQkJY3VycmVudF9vcHRpb249IiRjdXJyZW50X29wdGlvbiAke29wdGlvbl5efSIKCQkJZmkKCQlmaQoJCWlmICEgYXJnc3BhcnNlX2hhc19vcHRpb25fcHJvcGVydHkgIiRvcHRpb24iIG1hbmRhdG9yeQoJCXRoZW4KCQkJY3VycmVudF9vcHRpb249IlsgJGN1cnJlbnRfb3B0aW9uIF0iCgkJZmkKCQlfX2FyZ3NwYXJzZV91c2FnZV9zaG9ydF9saW5lX21hbmFnZW1lbnQgIiRjdXJyZW50X29wdGlvbiIKCWRvbmUKCWlmIF9fYXJnc3BhcnNlX2hhc19hcnJheV9pdGVtIF9fYXJnc3BhcnNlX3BhcmFtZXRlcnNfZGVzY3JpcHRpb24gQAoJdGhlbgoJICAgZm9yIHBhcmFtIGluICIke19fYXJnc3BhcnNlX3BhcmFtZXRlcnNfZGVzY3JpcHRpb25bQF19IgoJICAgZG8KCQkgICBfX2FyZ3NwYXJzZV91c2FnZV9zaG9ydF9saW5lX21hbmFnZW1lbnQgIiRwYXJhbSIKCSAgIGRvbmUKCWZpCglwcmludGYgLS0gIiVzXG4iICIkY3VycmVudF9saW5lIgp9CgoKIyMgQGZuIGFyZ3NwYXJzZV9kZXNjcmliZV9wYXJhbWV0ZXJzKCkKIyMgQGJyaWVmIERlc2NyaWJlIG5vbi1vcHRpb24gcG9zaXRpb25uYWwgcGFyYW1ldGVycy4KIyMgQGRldGFpbHMgVGhpcyBmdW5jdGlvbiBoYXMgY3VycmVudGx5IDIgcHVycG9zZXM6CiMjIC0gZW5oYW5jZSB0aGUgInNob3J0IiB1c2FnZSBwcm9ncmFtIGRlc2NyaXB0aW9uIChzZWUKIyMgYXJnc3BhcnNlX3VzYWdlX3Nob3J0KCkpCiMjIC0gY29tcHV0ZSB0aGUgbWluaW11bSBhbmQgbWF4aW11bSBudW1iZXJzIG9mIG5vbi1vcHRpb24KIyMgcG9zaXRpb25uYWwgcGFyYW1ldGVycyBhbmQgd2lsbCBvdmVyd3JpdGUgcHJldmlvdXMgc2V0dGluZ3MgdXNpbmcKIyMgYXJnc3BhcnNlX21pbmltdW1fcGFyYW1ldGVycygpIGFuZCBhcmdzcGFyc2VfbWF4aW11bV9wYXJhbWV0ZXJzKCkuCiMjCiMjIEBwYXJhbSBwYXJhbS4uLiBhIGxpc3Qgb2YgbGFiZWwgZGVzY3JpYmluZyBwb3NpdGlvbm5hbAojIyBwYXJhbWV0ZXJzLiBUaGVzZSBsYWJlbHMgY2FuIGhhdmUgc3BlY2lhbCBmb3JtcyBzdWNoIGFzOgojIyAtICJsYWJlbD8iIGEgc2luZ2xlIG9wdGlvbmFsIG5vbi1yZXBlYXRhYmxlIHBhcmFtZXRlcgojIyAtICJsYWJlbCsiIGEgbm9uLWVtcHR5IGxpc3Qgb2YgcGFyYW1ldGVycwojIyAtICJsYWJlbCoiIGEgcG90ZW50aWFsbHktZW1wdHkgbGlzdCBvZiBwYXJhbWV0ZXJzCiMjIC0gImxhYmVsIiBhIHNpbmdsZSBub24tb3B0aW9uYWwgbm9uLXJlcGVhdGFibGUgcGFyYW1ldGVyCiMjIEByZXR2YWwgMAojIyBAaW5ncm91cCBBcmdzcGFyc2VVc2FnZQphcmdzcGFyc2VfZGVzY3JpYmVfcGFyYW1ldGVycygpIHsKCVtbICQjIC1lcSAwIF1dICYmIHJldHVybgoJbG9jYWwgcGFyYW0gbGFzdCBuYW1lCglsb2NhbCAtaSBtaW49MCBtYXg9MAoJX19hcmdzcGFyc2VfcGFyYW1ldGVyc19kZXNjcmlwdGlvbj0oICJbLS1dIiApCglmb3IgcGFyYW0gaW4gIiRAIgoJZG8KCQluYW1lPSR7cGFyYW0lP30KCQlsYXN0PSR7cGFyYW0jJG5hbWV9CgkJY2FzZSAiJGxhc3QiIGluCgkJCSc/JykKCQkJCTogbWF4aW11bSBwYXJhbSAkKCgrK21heCkpCgkJCQlfX2FyZ3NwYXJzZV9wYXJhbWV0ZXJzX2Rlc2NyaXB0aW9uKz0oICJbICRuYW1lIF0iICkKCQkJCTs7CgkJCScqJykKCQkJCW1heD0xMDAwMDAwCgkJCQlfX2FyZ3NwYXJzZV9wYXJhbWV0ZXJzX2Rlc2NyaXB0aW9uKz0oICJbICRuYW1lIC4uLiBdIiApCgkJCQk7OwoJCQkrKQoJCQkJbWF4PTEwMDAwMDAKCQkJCTogbWluaW11bSBwYXJhbSAkKCgrK21pbikpCgkJCQlfX2FyZ3NwYXJzZV9wYXJhbWV0ZXJzX2Rlc2NyaXB0aW9uKz0oICIkbmFtZSBbICRuYW1lIC4uLiBdIiApCgkJCQk7OwoJCQkqKQoJCQkJOiBtYXhpbXVtIHBhcmFtICQoKCsrbWF4KSkKCQkJCTogbWluaW11bSBwYXJhbSAkKCgrK21pbikpCgkJCQlfX2FyZ3NwYXJzZV9wYXJhbWV0ZXJzX2Rlc2NyaXB0aW9uKz0oICIkcGFyYW0iICkKCQllc2FjCglkb25lCglhcmdzcGFyc2VfbWluaW11bV9wYXJhbWV0ZXJzICIkbWluIgoJYXJnc3BhcnNlX21heGltdW1fcGFyYW1ldGVycyAiJG1heCIKfQoKCiMjIEBmbiBhcmdzcGFyc2VfdXNhZ2VfbG9uZygpCiMjIEBicmllZiBGdWxseSBkZXNjcmliZSB0aGUgcHJvZ3JhbSBzeW50YXggYW5kIG9wdGlvbnMgdG8gdGhlIGVuZC11c2VyLgojIyBAZGV0YWlscyBUaGlzIGZ1bmN0aW9uIGdlbmVyYXRlcyBhbmQgcHJpbnRzIHRoZSAibG9uZyIgZGVzY3JpcHRpb24KIyMgb2YgdGhlIHByb2dyYW0gdXNhZ2UuIFByaW50IGFsbCBvcHRpb25zIGFsb25nIHdpdGggdGhlaXIKIyMgZGVzY3JpcHRpb25zIHByb3ZpZGVkIHRvIGFyZ3NwYXJzZV91c2Vfb3B0aW9uKCkuCiMjIEBpbmdyb3VwIEFyZ3NwYXJzZVVzYWdlCmFyZ3NwYXJzZV91c2FnZV9sb25nKCkgewoJbG9jYWwgbG9uZyBzaG9ydCBzZXAgZm9ybWF0IGFycmF5IHByb3BlcnR5IHByb3BzdHJpbmcKCWxvY2FsIHE9XCcgYm9sPSdcdFx0ICAnCglsb2NhbCAtQSBsb25nX3RvX3Nob3J0PSgpCglsb2NhbCAtYSB2YWx1ZXMKCSMgUmV2ZXJzZSB0aGUgX19hcmdzcGFyc2Vfc2hvcnRfb3B0aW9ucyBhcnJheS4KCWZvciBzaG9ydCBpbiAiJHshX19hcmdzcGFyc2Vfc2hvcnRfb3B0aW9uc1tAXX0iCglkbwoJCWxvbmc9JHtfX2FyZ3NwYXJzZV9zaG9ydF9vcHRpb25zWyIkc2hvcnQiXX0KCQlsb25nX3RvX3Nob3J0WyIkbG9uZyJdPSRzaG9ydAoJZG9uZQoJZm9yIGxvbmcgaW4gIiR7IV9fYXJnc3BhcnNlX29wdGlvbnNfZGVzY3JpcHRpb25zW0BdfSIKCWRvCgkJaWYgYXJnc3BhcnNlX2hhc19vcHRpb25fcHJvcGVydHkgIiRsb25nIiBoaWRkZW4KCQl0aGVuCgkJCWNvbnRpbnVlCgkJZmkKCQkjIFByZXR0eSBwcmludGVyIGlzc3VlIGhlcmUuIElmIHRoZSBsb25nIG9wdGlvbiBsZW5ndGggaXMKCQkjIGdyZWF0ZXIgdGhhbiA4LCB3ZSBqdXN0IHVzZSBuZXh0IGxpbmUgdG8gcHJpbnQgdGhlIG9wdGlvbgoJCSMgZGVzY3JpcHRpb24uCgkJaWYgW1sgIiR7I2xvbmd9IiAtbGUgOSBdXQoJCXRoZW4KCQkJc2VwPScgJwoJCWVsc2UKCQkJc2VwPSJcbiRib2wiCgkJZmkKCQkjIERlZmluZSBmb3JtYXQgYWNjb3JkaW5nIHRvIHRoZSBwcmVzZW5jZSBvZiB0aGUgc2hvcnQgb3B0aW9uLgoJCWlmIF9fYXJnc3BhcnNlX2hhc19hcnJheV9pdGVtIGxvbmdfdG9fc2hvcnQgIiRsb25nIgoJCXRoZW4KCQkJc2hvcnQ9IiR7bG9uZ190b19zaG9ydFskbG9uZ119IgoJCQlmb3JtYXQ9IiAtJXMgfCAlLSAxMXMkc2VwJXNcbiIKCQllbHNlCgkJCXNob3J0PSIiCgkJCWZvcm1hdD0iICVzICAgICAlLSAxMXMkc2VwJXNcbiIKCQlmaQoJCXByaW50ZiAtLSAiJGZvcm1hdCIgIiRzaG9ydCIgIi0tJGxvbmciIFwKCQkJIiR7X19hcmdzcGFyc2Vfb3B0aW9uc19kZXNjcmlwdGlvbnNbIiRsb25nIl19IgoJCWlmIGFyZ3NwYXJzZV9oYXNfb3B0aW9uX3Byb3BlcnR5ICIkbG9uZyIgY3VtdWxhdGl2ZSB8fCBcCgkJCWFyZ3NwYXJzZV9oYXNfb3B0aW9uX3Byb3BlcnR5ICIkbG9uZyIgY3VtdWxhdGl2ZXNldAoJCXRoZW4KCQkJcHJpbnRmICIke2JvbH1DYW4gYmUgcmVwZWF0ZWQuXG4iCgkJZmkKCQlpZiBhcmdzcGFyc2VfaGFzX29wdGlvbl9wcm9wZXJ0eSAiJGxvbmciIHZhbHVlCgkJdGhlbgoJCQlpZiBhcnJheT0kKF9fYXJnc3BhcnNlX3ZhbHVlc19hcnJheV9pZGVudGlmaWVyICIkbG9uZyIpCgkJCXRoZW4KCQkJCXZhbHVlcz0oICIkeyFhcnJheX0iICkKCQkJCXZhbHVlcz0oICIke3ZhbHVlc1tAXS8lLyRxfSIgKQoJCQkJdmFsdWVzPSggIiR7dmFsdWVzW0BdLyMvJHF9IiApCgkJCQlwcmludGYgIiR7Ym9sfUFjY2VwdGFibGUgdmFsdWVzOiAlc1xuIiBcCgkJCQkJIiQoX19hcmdzcGFyc2Vfam9pbl9hcnJheSAiICIgIiR7dmFsdWVzW0BdfSIpIgoJCQlmaQoJCQlpZiBfX2FyZ3NwYXJzZV9pbmRleF9vZiAiJGxvbmciIFwKCQkJCSIkeyFfX2FyZ3NwYXJzZV9vcHRpb25zX2RlZmF1bHRfdmFsdWVzW0BdfSIgPi9kZXYvbnVsbAoJCQl0aGVuCgkJCQlwcmludGYgIiR7Ym9sfURlZmF1bHQ6ICVzXG4iIFwKCQkJCQkiJHtfX2FyZ3NwYXJzZV9vcHRpb25zX2RlZmF1bHRfdmFsdWVzWyRsb25nXX0iCgkJCWZpCgkJZmkKCQlsb2NhbCAtQSBwcm9wZXJ0aWVzPShbcmVxdWlyZV09IlJlcXVpcmVzIiBbYWxpYXNdPSJTYW1lIGFzIikKCQlmb3IgcHJvcGVydHkgaW4gIiR7IXByb3BlcnRpZXNbQF19IgoJCWRvCgkJCWlmIHByb3BzdHJpbmc9JChhcmdzcGFyc2VfaGFzX29wdGlvbl9wcm9wZXJ0eSAiJGxvbmciICIkcHJvcGVydHkiKQoJCQl0aGVuCgkJCQlyZWFkIC1hIHZhbHVlcyA8PDwiJHByb3BzdHJpbmciCgkJCQl2YWx1ZXM9KCAiJHt2YWx1ZXNbQF0vIy8tLX0iICkKCQkJCXByaW50ZiAiJHtib2x9JXM6ICVzXG4iIFwKCQkJCQkiJHtwcm9wZXJ0aWVzWyRwcm9wZXJ0eV19IiAiJHt2YWx1ZXNbKl19IgoJCQlmaQoJCWRvbmUKCQlpZiBhcmdzcGFyc2VfYXJlX2Vudmlyb25tZW50X3ZhcmlhYmxlc19lbmFibGVkCgkJdGhlbgoJCQlwcmludGYgIiR7Ym9sfUVudmlyb25tZW50IHZhcmlhYmxlOiAlc1xuIiBcCgkJCQkiJChhcmdzcGFyc2Vfb3B0aW9uX2Vudmlyb25tZW50X3ZhcmlhYmxlX25hbWUgIiRsb25nIikiCgkJZmkKCWRvbmUKfQoKIyMgQHZhciBTdHJpbmcgYXJnc3BhcnNlX3VzYWdlX2Rlc2NyaXB0aW9uCiMjIEBicmllZiBVc2FnZSBkZXNjcmlwdGlvbiBhZGRpdGlvbm5hbCBzdHJpbmcuCiMjIEBkZXRhaWxzIFRoZSBjb250ZW50IG9mIHRoaXMgdmFyaWFibGUgd2lsbCBiZSBhcHBlbmRlZCB0byB0aGUKIyMgYXJnc3BhcnNlX3VzYWdlKCkgb3V0cHV0LgojIyBAaW5ncm91cCBBcmdzcGFyc2VVc2FnZQpkZWNsYXJlIGFyZ3NwYXJzZV91c2FnZV9kZXNjcmlwdGlvbgoKIyMgQGZuIGFyZ3NwYXJzZV91c2FnZSgpCiMjIEBicmllZiBBIGdlbmVyaWMgaGVscCBtZXNzYWdlIGdlbmVyYXRlZCBmcm9tIHRoZSBvcHRpb25zIGFuZCB0aGVpcgojIyBkZXNjcmlwdGlvbnMuCiMjIEBkZXRhaWxzIFdpbGwgcHJpbnQgYm90aCBhIHJhdGhlci1zaG9ydCBhbmQgYSBxdWl0ZSBsb25nCiMjIGRlc2NyaXB0aW9uIG9mIHRoZSBwcm9ncmFtIGFuZCBpdHMgb3B0aW9ucy4gSnVzdCBwcm92aWRlZCB0byBiZQojIyB3cmFwcGVkIGluIHlvdXIgb3duIHVzYWdlKCkuCiMjIEBpbmdyb3VwIEFyZ3NwYXJzZVVzYWdlCmFyZ3NwYXJzZV91c2FnZSgpIHsKCSMgVGhlcmUncyBzdGlsbCBhIGxvdCBvZiByb29tIGZvciBpbXByb3ZlbWVudCBoZXJlLgoJYXJnc3BhcnNlX3VzYWdlX3Nob3J0CglwcmludGYgIlxuIgoJIyBUaGlzIHdpbGwgcHJpbnQgb3B0aW9uIGRlc2NyaXB0aW9ucy4KCWFyZ3NwYXJzZV91c2FnZV9sb25nCglbWyAtbiAiJHthcmdzcGFyc2VfdXNhZ2VfZGVzY3JpcHRpb246LX0iIF1dICYmIFwKCQlwcmludGYgIlxuJXNcbiIgIiRhcmdzcGFyc2VfdXNhZ2VfZGVzY3JpcHRpb24iIHx8IDoKfQoKCiMgRm9sbG93aW5nIGZ1bmN0aW9ucyBkZWZpbmUgdGhlIGRlZmF1bHQgb3B0aW9uLXNldHRpbmcgaG9vayBhbmQgaXRzCiMgd2l0aC93aXRob3V0IHZhbHVlIGNvdW50ZXItcGFydHMuIFRoZXkgY2FuIGJlIHJlZmVyZXJlZCBpbiBleHRlcm5hbAojIHNvdXJjZSBjb2RlLCB0aG91Z2ggdGhleSBzaG91bGQgb25seSBiZSBpbiB1c2VyLWRlZmluZWQKIyBvcHRpb24tc2V0dGluZyBob29rcy4KCiMgQWxsIHVzZXItZGVmaW5lZCBvcHRpb24tc2V0dGluZyBob29rIHNob3VsZCBiZSBkZWZpbmVkIGxpa2UKIyBhcmdzcGFyc2Vfc2V0X29wdGlvbgoKIyMgQGZuIGFyZ3NwYXJzZV9zZXRfb3B0aW9uX3dpdGhvdXRfdmFsdWUoKQojIyBAYnJpZWYgVGhlIG9wdGlvbi1zZXR0aW5nIGhvb2sgZm9yIG9wdGlvbnMgbm90IGFjY2VwdGluZyB2YWx1ZXMuCiMjIEBwYXJhbSBvcHRpb24gYW4gb3B0aW9uIG5hbWUuCiMjIEByZXR2YWwgMAojIyBAaW5ncm91cCBBcmdzcGFyc2VPcHRpb25TZXR0ZXIKYXJnc3BhcnNlX3NldF9vcHRpb25fd2l0aG91dF92YWx1ZSgpIHsKCVtbICQjIC1lcSAxIF1dIHx8IHJldHVybiAxCglsb2NhbCBvcHRpb249JDEKCTogJCgocHJvZ3JhbV9vcHRpb25zWyIkb3B0aW9uIl0rKykpCn0KCiMjIEBmbiBhcmdzcGFyc2Vfc2V0X29wdGlvbl93aXRoX3ZhbHVlKCkKIyMgQGJyaWVmICJ2YWx1ZSIgcHJvcGVydHkgc3BlY2lmaWMgb3B0aW9uLXNldHRpbmcgaG9vay4KIyMgQHBhcmFtIG9wdGlvbiBhbiBvcHRpb24gbmFtZS4KIyMgQHBhcmFtIHZhbHVlIHRoZSB2YWx1ZSBwdXQgb24gY29tbWFuZCBsaW5lIGZvciBnaXZlbiBvcHRpb24uCiMjIEBpbmdyb3VwIEFyZ3NwYXJzZU9wdGlvblNldHRlcgphcmdzcGFyc2Vfc2V0X29wdGlvbl93aXRoX3ZhbHVlKCkgewoJW1sgJCMgLWVxIDIgXV0gfHwgcmV0dXJuIDEKCWxvY2FsIG9wdGlvbj0kMQoJbG9jYWwgdmFsdWU9JDIKCXByb2dyYW1fb3B0aW9uc1siJG9wdGlvbiJdPSR2YWx1ZQp9CgojIyBAZm4gYXJnc3BhcnNlX2dldF9jdW11bGF0aXZlX2FycmF5X25hbWUoKQojIyBAcGFyYW0gb3B0aW9uIGFuIG9wdGlvbiBuYW1lLgojIyBAYnJpZWYgUHJpbnQgdGhlIG5hbWUgb2YgdGhlIGFycmF5IHVzZWQgZm9yICJjdW11bGF0aXZlIiBhbmQKIyMgImN1bXVsYXRpdmVzZXQiIG9wdGlvbnMuCiMjIEBkZXRhaWxzIEZvciAib3B0aW9uLW5hbWUiIHVzdWFsbHkgcHJpbnRzCiMjICJjdW11bGF0ZWRfdmFsdWVzX29wdGlvbl9uYW1lIi4KIyMgQGluZ3JvdXAgQXJnc3BhcnNlT3B0aW9uU2V0dGVyCmFyZ3NwYXJzZV9nZXRfY3VtdWxhdGl2ZV9hcnJheV9uYW1lKCkgewoJW1sgJCMgLWVxIDEgXV0gfHwgcmV0dXJuIDEKCWxvY2FsIG9wdGlvbj0kMQoJbG9jYWwgaWRlbnQ9JChhcmdzcGFyc2Vfb3B0aW9uX3RvX2lkZW50aWZpZXIgIiRvcHRpb24iKQoJcHJpbnRmICJjdW11bGF0ZWRfdmFsdWVzXyVzIiAiJGlkZW50Igp9CgojIyBAZm4gYXJnc3BhcnNlX3NldF9jdW11bGF0aXZlX29wdGlvbigpCiMjIEBicmllZiAiY3VtdWxhdGl2ZSIgcHJvcGVydHkgc3BlY2lmaWMgb3B0aW9uLXNldHRpbmcgaG9vay4KIyMgQGRldGFpbHMgRGVmYXVsdCBhY3Rpb24gdG8gdGFrZSBmb3IgY3VtdWxhdGl2ZSBvcHRpb25zLiBTdG9yZSBAYQojIyB2YWx1ZSBpbnRvIGFuIGFycmF5IHdob3NlIG5hbWUgaXMgZ2VuZXJhdGVkIHVzaW5nCiMjIGFyZ3NwYXJzZV9nZXRfY3VtdWxhdGl2ZV9hcnJheV9uYW1lKCkuCiMjIEBwYXJhbSBvcHRpb24gYW4gb3B0aW9uIG5hbWUuCiMjIEBwYXJhbSB2YWx1ZSB0aGUgdmFsdWUgcHV0IG9uIGNvbW1hbmQgbGluZSBmb3IgZ2l2ZW4gb3B0aW9uLgojIyBAaW5ncm91cCBBcmdzcGFyc2VPcHRpb25TZXR0ZXIKYXJnc3BhcnNlX3NldF9jdW11bGF0aXZlX29wdGlvbigpIHsKCVtbICQjIC1lcSAyIF1dIHx8IHJldHVybiAxCglsb2NhbCBvcHRpb249JDEKCWxvY2FsIHZhbHVlPSQyCglsb2NhbCBhcnJheT0iJChhcmdzcGFyc2VfZ2V0X2N1bXVsYXRpdmVfYXJyYXlfbmFtZSAiJG9wdGlvbiIpIgoJbG9jYWwgc2l6ZSB0ZW1wPSIkYXJyYXlbQF0iCglsb2NhbCAtYSBjb3B5CglpZiBfX2FyZ3NwYXJzZV9oYXNfYXJyYXlfaXRlbSAiJGFycmF5IiAwCgl0aGVuCgkJY29weT0oICIkeyF0ZW1wfSIgKQoJCXNpemU9JHsjY29weVtAXX0KCWVsc2UKCQlzaXplPTAKCWZpCglwcmludGYgLXYgIiRhcnJheVskc2l6ZV0iICVzICIkdmFsdWUiCglhcmdzcGFyc2Vfc2V0X29wdGlvbl93aXRob3V0X3ZhbHVlICIkb3B0aW9uIgp9CgojIyBAZm4gYXJnc3BhcnNlX3NldF9jdW11bGF0aXZlc2V0X29wdGlvbigpCiMjIEBwYXJhbSBvcHRpb24gYW4gb3B0aW9uIG5hbWUuCiMjIEBwYXJhbSB2YWx1ZSBhIG5ldyB2YWx1ZSBmb3IgdGhlIG9wdGlvbi4KIyMgQGJyaWVmICJjdW11bGF0aXZlc2V0IiBwcm9wZXJ0eSBzcGVjaWZpYyBvcHRpb24tc2V0dGluZyBob29rLgojIyBAZGV0YWlscyBEZWZhdWx0IGFjdGlvbiB0byB0YWtlIGZvciBjdW11bGF0aXZlc2V0IG9wdGlvbnMuIEFjdAojIyBleGFjdGx5IGxpa2UgYXJnc3BhcnNlX3NldF9jdW11bGF0aXZlX29wdGlvbigpIGV4Y2VwdCB0aGF0IHZhbHVlcwojIyBhcmUgbm90IGR1cGxpY2F0ZWQgaW4gdGhlIGN1bXVsYXRlZCB2YWx1ZXMgYXJyYXkuCiMjIEBpbmdyb3VwIEFyZ3NwYXJzZU9wdGlvblNldHRlcgphcmdzcGFyc2Vfc2V0X2N1bXVsYXRpdmVzZXRfb3B0aW9uKCkgewoJW1sgJCMgLWVxIDIgXV0gfHwgcmV0dXJuIDEKCWxvY2FsIG9wdGlvbj0kMQoJbG9jYWwgdmFsdWU9JDIKCWxvY2FsIGFycmF5X25hbWU9IiQoYXJnc3BhcnNlX2dldF9jdW11bGF0aXZlX2FycmF5X25hbWUgIiRvcHRpb24iKSIKCWxvY2FsIGFycmF5PSIkYXJyYXlfbmFtZVtAXSIKCWlmICEgX19hcmdzcGFyc2VfaGFzX2FycmF5X2l0ZW0gIiRhcnJheV9uYW1lIiB8fCBcCgkJICAgISBfX2FyZ3NwYXJzZV9pbmRleF9vZiAiJHZhbHVlIiAiJHshYXJyYXl9IiA+L2Rldi9udWxsCgl0aGVuCgkJIyBUaGUgdmFsdWUgaXMgbm90IGFscmVhZHkgaW4gdGhlIGFycmF5LCBzbyBhZGQgaXQuCgkJYXJnc3BhcnNlX3NldF9jdW11bGF0aXZlX29wdGlvbiAiJG9wdGlvbiIgIiR2YWx1ZSIKCWZpCn0KCiMjIEBmbiBhcmdzcGFyc2Vfc2V0X2FsaWFzKCkKIyMgQHBhcmFtIG9wdGlvbiBhbiBvcHRpb24gbmFtZS4KIyMgQGJyaWVmICJhbGlhcyIgcHJvcGVydHkgc3BlY2lmaWMgb3B0aW9uLXNldHRpbmcgaG9vay4KIyMgQGRldGFpbHMgV2hlbiBhbiBvcHRpb24gaXMgYW4gYWxpYXMgZm9yIG90aGVyIG9wdGlvbihzKSwgdGhlbiBzZXQKIyMgdGhlIGFsaWFzZXMgb3B0aW9ucy4KIyMgQGluZ3JvdXAgQXJnc3BhcnNlT3B0aW9uU2V0dGVyCmFyZ3NwYXJzZV9zZXRfYWxpYXMoKSB7CgkjIFRoaXMgb3B0aW9uIHdpbGwgc2V0IGFsbCBvcHRpb25zIGFsaWFzZWQgYnkgYW5vdGhlci4KCVtbICQjIC1lcSAxIF1dIHx8IHJldHVybiAxCglsb2NhbCBvcHRpb249JDEKCWxvY2FsIGFsaWFzZXMKCWlmICEgYWxpYXNlcz0iJChhcmdzcGFyc2VfaGFzX29wdGlvbl9wcm9wZXJ0eSAiJG9wdGlvbiIgYWxpYXMpIgoJdGhlbgoJCXJldHVybiAxCglmaQoJd2hpbGUgW1sgIiRhbGlhc2VzIiA9fiBeXCAqKFteXCBdKykoXCAoLispKT9cICokIF1dCglkbwoJCSMgQXQgdGhpcyBwb2ludCwgQkFTSF9SRU1BVENIWzFdIGlzIHRoZSBmaXJzdCBhbGlhcywgYW5kCgkJIyBCQVNIX1JFTUFUQ0hbM10gaXMgdGhlIG1heWJlLWVtcHR5IGxpc3Qgb2Ygb3RoZXIgYWxpYXNlcy4KCQkjIF9fYXJnc3BhcnNlX3NldF9vcHRpb24gd2lsbCBhbHRlciBCQVNIX1JFTUFUQ0gsIHNvIG1vZGlmeQoJCSMgYWxpYXNlcyBmaXJzdC4KCQlhbGlhc2VzPSR7QkFTSF9SRU1BVENIWzNdfQoJCV9fYXJnc3BhcnNlX3NldF9vcHRpb24gIiR7QkFTSF9SRU1BVENIWzFdfSIKCWRvbmUKfQoKCiMjIEBmbiBhcmdzcGFyc2Vfc2V0X29wdGlvbigpCiMjIEBicmllZiBEZWZhdWx0IG9wdGlvbi1zZXR0aW5nIGhvb2suCiMjIEBwYXJhbSBvcHRpb24gVGhlIG9wdGlvbiBiZWluZyBzZXQuCiMjIEBwYXJhbSB2YWx1ZSB0aGUgdmFsdWUgb2YgdGhlIG9wdGlvbiAob3B0aW9uYWwpLgojIyBAZGV0YWlscyBUaGlzIGZ1bmN0aW9uIHdpbGwgYmUgY2FsbGVkIGJ5IGFyZ3NwYXJzZV9wYXJzZV9vcHRpb25zKCkKIyMgd2hlbmV2ZXIgYSBnaXZlbiBvcHRpb24gaXMgYmVpbmcgc2V0IGFuZCBubyBjdXN0b20gc2V0dGluZyBob29rIGlzCiMjIGRlZmluZWQgZm9yIHNhaWQgb3B0aW9uLiBEZXBlbmRpbmcgb2YgdGhlIHByb3BlcnRpZXMgb2YgdGhlIG9wdGlvbiwKIyMgYSBtb3JlIHNwZWNpZmljIHNldHRpbmcgaG9vayB3aWxsIGJlIGNhbGxlZC4KIyMgQGluZ3JvdXAgQXJnc3BhcnNlT3B0aW9uU2V0dGVyCmFyZ3NwYXJzZV9zZXRfb3B0aW9uKCkgewoJW1sgJCMgLWVxIDIgfHwgJCMgLWVxIDEgXV0gfHwgcmV0dXJuIDEKCWxvY2FsIG9wdGlvbj0kMQoJaWYgW1sgJCMgLWVxIDIgXV0KCXRoZW4KCQlsb2NhbCB2YWx1ZT0kMgoJZmkKCWxvY2FsIHByb3BlcnR5Cglsb2NhbCAtQSBzZXR0ZXJzPSgKCQlbY3VtdWxhdGl2ZV09YXJnc3BhcnNlX3NldF9jdW11bGF0aXZlX29wdGlvbgoJCVtjdW11bGF0aXZlc2V0XT1hcmdzcGFyc2Vfc2V0X2N1bXVsYXRpdmVzZXRfb3B0aW9uCgkJW3ZhbHVlXT1hcmdzcGFyc2Vfc2V0X29wdGlvbl93aXRoX3ZhbHVlCgkpCgoJaWYgISBhcmdzcGFyc2Vfc2V0X2FsaWFzICIkb3B0aW9uIgoJdGhlbgoJCSMgV2UgZG9udCB1c2UgJHshc2V0dGVyc1tAXX0gaGVyZSwgYmVjYXVzZSBvcmRlciBtYXR0ZXJzLgoJCWZvciBwcm9wZXJ0eSBpbiBjdW11bGF0aXZlIGN1bXVsYXRpdmVzZXQgdmFsdWUKCQlkbwoJCQlpZiBhcmdzcGFyc2VfaGFzX29wdGlvbl9wcm9wZXJ0eSAiJG9wdGlvbiIgIiRwcm9wZXJ0eSIKCQkJdGhlbgoJCQkJIiR7c2V0dGVyc1skcHJvcGVydHldfSIgIiRvcHRpb24iICIkdmFsdWUiCgkJCQlyZXR1cm4KCQkJZmkKCQlkb25lCgkJYXJnc3BhcnNlX3NldF9vcHRpb25fd2l0aG91dF92YWx1ZSAiJG9wdGlvbiIKCWZpCn0KCgojIERlZmF1bHQgYmVoYXZpb3VyIGlzIG5vdCB0byBhY2NlcHQgZW1wdHkgY29tbWFuZCBsaW5lcy4KX19hcmdzcGFyc2VfYWxsb3dfbm9fYXJndW1lbnQ9bm8KCgojIyBAZm4gYXJnc3BhcnNlX2FsbG93X25vX2FyZ3VtZW50KCkKIyMgQGJyaWVmIEFsbG93IGVtcHR5IGNvbW1hbmQgbGluZXMgdG8gcnVuLgojIyBAZGV0YWlscyBDaGFuZ2UgYXJnc3BhcnNlIGJlaGF2aW91ciBmb3IgZW1wdHkgY29tbWFuZAojIyBsaW5lcy4gRGVmYXVsdCBzYXlzICJubyBhcmd1bWVudCB0cmlnZ2VycyB1c2FnZSIuCiMjIEBwYXJhbSBzdHJpbmcgaWYgKGNhc2UtaW5zZW5zaXRpdmUpICJ5ZXMiLCAidHJ1ZSIgb3IgIjEiLCB0aGUgdmFsdWUKIyMgaXMgY29uc2lkZXJlZCBhcyBhZmZpcm1hdGl2ZS4gQW55dGhpbmcgZWxzZSBpcyBhIG5lZ2F0aXZlIHZhbHVlLgojIyBAcmV0dmFsIDAgdW5sZXNzIHRoZXJlJ3MgbW9yZSB0aGFuIG9uZSBwYXJhbWV0ZXIgKG9yIG5vbmUpLgojIyBAaW5ncm91cCBBcmdzcGFyc2VQYXJhbWV0ZXIKYXJnc3BhcnNlX2FsbG93X25vX2FyZ3VtZW50KCkgewoJW1sgJCMgLWVxIDEgXV0gfHwgcmV0dXJuIDEKCWxvY2FsIHBhcmFtPSQxCgljYXNlICIke3BhcmFtLCx9IiBpbgoJCXllc3x0cnVlfDEpCgkJCV9fYXJnc3BhcnNlX2FsbG93X25vX2FyZ3VtZW50PXllcwoJCQk7OwoJCSopCgkJCV9fYXJnc3BhcnNlX2FsbG93X25vX2FyZ3VtZW50PW5vCgkJCTs7Cgllc2FjCn0KCgojIyBAYnJpZWYgSW50ZXJuYWwgdXNlIG9ubHkuCiMjIEBkZXRhaWxzIFRoZSBkZWZhdWx0IG1pbmltdW0gcGFyYW1ldGVycyByZXF1aXJlbWVudCBmb3IgY29tbWFuZCBsaW5lLgojIyBAaW5ncm91cCBBcmdzcGFyc2VQYXJhbWV0ZXIKZGVjbGFyZSAtaSBfX2FyZ3NwYXJzZV9taW5pbXVtX3BhcmFtZXRlcnM9MAoKCiMjIEBicmllZiBJbnRlcm5hbCB1c2Ugb25seS4KIyMgQGRldGFpbHMgVGhlIGRlZmF1bHQgbWF4aW11bSBwYXJhbWV0ZXJzIHJlcXVpcmVtZW50IGZvciBjb21tYW5kCiMjIGxpbmUuICJTaG91bGQgYmUgZW5vdWdoIGZvciBldmVyeW9uZSIuCiMjIEBpbmdyb3VwIEFyZ3NwYXJzZVBhcmFtZXRlcgpkZWNsYXJlIC1pIF9fYXJnc3BhcnNlX21heGltdW1fcGFyYW1ldGVycz0xMDAwMDAwCgoKIyMgQGZuIGFyZ3NwYXJzZV9taW5pbXVtX3BhcmFtZXRlcnMoKQojIyBAYnJpZWYgU2V0IHRoZSBtaW5pbXVtIG51bWJlciBvZiBub24tb3B0aW9uIHBhcmFtZXRlcnMgZXhwZWN0ZWQgb24KIyMgdGhlIGNvbW1hbmQgbGluZS4KIyMgQHBhcmFtIHVuc2lnbmVkX2ludCBhIHBvc2l0aXZlIG51bWJlci4KIyMgQHJldHZhbCAwIGlmIHRoZXJlIGlzIGFuIHVuc2lnbmVkIGludGVnZXIgaXMgcHJvdmlkZWQgYW5kIGlzIHRoZQojIyBzaW5nbGUgcGFyYW1ldGVyIG9mIHRoaXMgZnVuY3Rpb24uCiMjIEByZXR2YWwgMSBpbiBvdGhlciBjYXNlcy4KIyMgQGluZ3JvdXAgQXJnc3BhcnNlUGFyYW1ldGVyCmFyZ3NwYXJzZV9taW5pbXVtX3BhcmFtZXRlcnMoKSB7CglbWyAkIyAtZXEgMSBdXSB8fCByZXR1cm4gMQoJbG9jYWwgbWluPSQxCglbWyAiJG1pbiIgPSArKFswLTldKSBdXSB8fCByZXR1cm4gMQoJX19hcmdzcGFyc2VfbWluaW11bV9wYXJhbWV0ZXJzPSRtaW4KfQoKIyMgQGZuIGFyZ3NwYXJzZV9tYXhpbXVtX3BhcmFtZXRlcnMoKQojIyBAYnJpZWYgU2V0IHRoZSBtYXhpbXVtIG51bWJlciBvZiBub24tb3B0aW9uIHBhcmFtZXRlcnMgZXhwZWN0ZWQgb24KIyMgdGhlIGNvbW1hbmQgbGluZS4KIyMgQHBhcmFtIHVuc2lnbmVkX2ludCBhIHBvc2l0aXZlIG51bWJlci4KIyMgQHJldHZhbCAwIGlmIHRoZXJlIGlzIGFuIHVuc2lnbmVkIGludGVnZXIgaXMgcHJvdmlkZWQgYW5kIGlzIHRoZQojIyBzaW5nbGUgcGFyYW1ldGVyIG9mIHRoaXMgZnVuY3Rpb24uCiMjIEByZXR2YWwgMSBpbiBvdGhlciBjYXNlcy4KIyMgQGluZ3JvdXAgQXJnc3BhcnNlUGFyYW1ldGVyCmFyZ3NwYXJzZV9tYXhpbXVtX3BhcmFtZXRlcnMoKSB7CglbWyAkIyAtZXEgMSBdXSB8fCByZXR1cm4gMQoJbG9jYWwgbWF4PSQxCglbWyAiJG1heCIgPSArKFswLTldKSBdXSB8fCByZXR1cm4gMQoJX19hcmdzcGFyc2VfbWF4aW11bV9wYXJhbWV0ZXJzPSRtYXgKfQoKCiMjIEB2YXIgU3RyaW5nIF9fYXJnc3BhcnNlX2Vudmlyb25tZW50X3ZhcmlhYmxlX3ByZWZpeAojIyBAYnJpZWYgVGhlIHByZWZpeCBmb3Igb3B0aW9uLXNldHRpbmcgZW52aXJvbm1lbnQgdmFyaWFibGVzCiMjIEBwcml2YXRlCiMjIEBpbmdyb3VwIEFyZ3NwYXJzZU9wdGlvblNldHRlcgpkZWNsYXJlIF9fYXJnc3BhcnNlX2Vudmlyb25tZW50X3ZhcmlhYmxlX3ByZWZpeAoKCiMjIEBmbiBhcmdzcGFyc2VfdXNlX2Vudmlyb25tZW50X3ZhcmlhYmxlcygpCiMjIEBicmllZiBFbmFibGUgb3B0aW9uIHNldHRpbmcgdGhyb3VnaCBlbnZpcm9ubWVudCB2YXJpYWJsZXMuCiMjIEBkZXRhaWxzCiMjIE9uY2UgZW5hYmxlZCwgaXQgY2Fubm90IGJlIGRpc2FibGVkLgojIyBAcGFyYW0gcHJlZml4IGFuIGVudmlyb25tZW50IHZhcmlhYmxlIHByZWZpeAojIyBAaW5ncm91cCBBcmdzcGFyc2VPcHRpb25TZXR0ZXIKYXJnc3BhcnNlX3VzZV9lbnZpcm9ubWVudF92YXJpYWJsZXMoKSB7Cglsb2NhbCBwcmVmaXgKCWNhc2UgJCMgaW4KCQkwKQoJCQlwcmVmaXg9JChhcmdzcGFyc2Vfb3B0aW9uX3RvX2lkZW50aWZpZXIgIiR7YXJnc3BhcnNlX3BnbSUuc2h9IikKCQkJcHJlZml4PSR7cHJlZml4Xl59CgkJCTs7CgkJMSkKCQkJcHJlZml4PSQxCgkJCTs7CgkJKikKCQkJcmV0dXJuIDEKCWVzYWMKCV9fYXJnc3BhcnNlX2Vudmlyb25tZW50X3ZhcmlhYmxlX3ByZWZpeD0kcHJlZml4Cn0KCgojIyBAZm4gYXJnc3BhcnNlX2FyZV9lbnZpcm9ubWVudF92YXJpYWJsZXNfZW5hYmxlZCgpCiMjIEBicmllZiBUZWxsIGlmIG9wdGlvbiBzZXR0aW5nIHRocm91Z2ggZW52aXJvbm1lbnQgdmFyaWFibGVzIGlzCiMjIGVuYWJsZWQgb3Igbm90LgojIyBAZGV0YWlscwojIyBAcmV0dmFsIDAgaWYgYXJnc3BhcnNlX3BhcnNlX29wdGlvbnMgd291bGQgYWxzbyByZXRyaWV2ZSBvcHRpb24KIyMgdmFsdWVzIGZyb20gZW52aXJvbm1lbnQgdmFyaWFibGVzLgojIyBAaW5ncm91cCBAQXJnc3BhcnNlT3B0aW9uU2V0dGVyCmFyZ3NwYXJzZV9hcmVfZW52aXJvbm1lbnRfdmFyaWFibGVzX2VuYWJsZWQoKSB7CglbWyAke19fYXJnc3BhcnNlX2Vudmlyb25tZW50X3ZhcmlhYmxlX3ByZWZpeDotfSBdXQp9CgoKIyMgQGZuIGFyZ3NwYXJzZV9vcHRpb25fZW52aXJvbm1lbnRfdmFyaWFibGVfbmFtZSgpCiMjIEBicmllZiBHaXZlIHRoZSBlbnZpcm9ubWVudCB2YXJpYWJsZSBuYW1lIGxpbmtlZCB0byBhbiBvcHRpb24KIyMgQGRldGFpbHMKIyMgUmV0dXJuIHRoZSBuYW1lIG9mIHRoZSBlbnZpcm9ubWVudCB2YXJpYWJsZSBuYW1lIHRoYXQgY2FuIGJlIHVzZWQKIyMgdG8gc2V0IGEgZ2l2ZW4gb3B0aW9uLiBXb3JrcyB3aGV0aGVyIG9wdGlvbiBzZXR0aW5nIHRocm91Z2gKIyMgZW52aXJvbm1lbnQgdmFyaWFibGVzIGlzIGVuYWJsZWQgb3Igbm90LgojIyBAcGFyYW0gb3B0aW9uIGFuIG9wdGlvbiBuYW1lCiMjIEByZXR1cm4gdGhlIGVudmlyb25tZW50IHZhcmlhYmxlIG5hbWUgbGlua2VkIHRvIHRoZSBvcHRpb24KYXJnc3BhcnNlX29wdGlvbl9lbnZpcm9ubWVudF92YXJpYWJsZV9uYW1lKCkgewoJW1sgJCMgLWVxIDEgXV0gfHwgcmV0dXJuIDEKCWxvY2FsIG9wdGlvbj0kMQoJbG9jYWwgaWRlbnRpZmllcj0kKGFyZ3NwYXJzZV9vcHRpb25fdG9faWRlbnRpZmllciAiJG9wdGlvbiIpCglwcmludGYgJXNfJXMgIiRfX2FyZ3NwYXJzZV9lbnZpcm9ubWVudF92YXJpYWJsZV9wcmVmaXgiICIke2lkZW50aWZpZXJeXn0iCn0KCgojIyBAZm4gYXJnc3BhcnNlX29wdGlvbl9lbnZpcm9ubWVudF92YXJpYWJsZSgpCiMjIEBicmllZiBHaXZlIHRoZSBjb250ZW50IG9mIHRoZSBlbnZpcm9ubWVudCB2YXJpYWJsZSB0aGF0IGNhbiBiZQojIyB1c2VkIHRvIHNldCBhIGdpdmVuIG9wdGlvbi4KIyMgQGRldGFpbHMKIyMgRG9lcyBub3QgY2hlY2sgaWYgb3B0aW9uIHNldHRpbmcgdGhyb3VnaCBlbnZpcm9ubWVudCB2YXJpYWJsZSBpcwojIyBlbmFibGVkIG9yIG5vdC4KIyMgQHBhcmFtIG9wdGlvbiBBbiBvcHRpb24gbmFtZQojIyBAcmV0dXJuIFRoZSBjb250ZW50IG9mIHRoZSBlbnZpcm9ubWVudCB2YXJpYWJsZSB0aGF0IG1hdGNoZXMgdGhlCiMjIGdpdmVuIG9wdGlvbi4KIyMgQHJldHZhbCAwIGlmIHRoZSB2YXJpYWJsZSB0aGF0IG1hdGNoZXMgdGhlIGdpdmVuIG9wdGlvbiBhY3R1YWxseQojIyBleGlzdHMgKGV2ZW4gaWYgaXRzIHZhbHVlIGlzIGVtcHR5KQphcmdzcGFyc2Vfb3B0aW9uX2Vudmlyb25tZW50X3ZhcmlhYmxlKCkgewoJW1sgJCMgLWVxIDEgXV0gfHwgcmV0dXJuIDEKCWxvY2FsIG9wdGlvbj0kMQoJbG9jYWwgdmFyPSQoYXJnc3BhcnNlX29wdGlvbl9lbnZpcm9ubWVudF92YXJpYWJsZV9uYW1lICIkb3B0aW9uIikKCWlmIFtbIC12ICR2YXIgXV07IHRoZW4KCQlwcmludGYgJXMgIiR7IXZhcn0iCgkJcmV0dXJuIDAKCWZpCglyZXR1cm4gMQp9CgoKIyMgQGZuIGFyZ3NwYXJzZV9zZXRfb3B0aW9uX2Zyb21fZW52aXJvbm1lbnRfdmFsdWUoKQojIyBAYnJpZWYgR2l2ZSBhIHZhbHVlIHRvIGFuIG9wdGlvbiwgZnJvbSBlbnZpcm9ubWVudCB2YXJpYWJsZSB2YWx1ZS4KIyMgQGRldGFpbHMKIyMgT3B0aW9ucyBjYW4gYmUgc2V0IGZyb20gZW52aXJvbm1lbnQgdmFyaWFibGVzLCBhbmQgaW4gc29tZSBjYXNlcywKIyMgdGhvc2UgdmFsdWVzIGhhdmUgc3BlY2lhbCBtZWFuaW5nczoKIyMgLSAwLCAiZmFsc2UiLCAibm8iIGFuZCB0aGUgZW1wdHkgc3RyaW5nIGFyZSBleHBsaWNpdCB2YWx1ZXMgdG8KIyMgZGlzYWJsZSBhIG5vbi12YWx1ZWQgb3B0aW9uCiMjIC0gKHByb2JhYmx5IG1vcmUgdG8gY29tZSkKIyMgLgojIyBAcGFyYW0gb3B0aW9uIGFuIG9wdGlvbiBuYW1lCiMjIEBwYXJhbSB2YWx1ZSB0aGUgdmFsdWUsIGFzIGZvdW5kIGluIHRoZSBwcm9jZXNzIGVudmlyb25tZW50LCB0byBzZXQKIyMgdGhlIG9wdGlvbiB0by4KYXJnc3BhcnNlX3NldF9vcHRpb25fZnJvbV9lbnZpcm9ubWVudF92YWx1ZSgpIHsKCVtbICQjIC1lcSAyIF1dIHx8IHJldHVybiAxCglsb2NhbCBvcHRpb249JDEKCWxvY2FsIHZhbHVlPSQyCglpZiAhIGFyZ3NwYXJzZV9oYXNfb3B0aW9uX3Byb3BlcnR5ICIkb3B0aW9uIiB2YWx1ZQoJdGhlbgoJCWlmIFtbICR2YWx1ZSAhPSArKDB8ZmFsc2V8bm98IiIpIF1dCgkJdGhlbgoJCQlhcmdzcGFyc2Vfc2V0X29wdGlvbiAiJG9wdGlvbiIKCQlmaQoJIyBUaGVyZSBzaG91bGQgYmUgYW4gZWxpZiBzdGF0ZW1lbnQgaGVyZSwgaWYgd2Ugd2FudCB0byBjb25zaWRlcgoJIyBjdW11bGF0ZWQgb3B0aW9ucyBkaWZmZXJlbnRseS4KCWVsc2UKCQlhcmdzcGFyc2Vfc2V0X29wdGlvbiAiJG9wdGlvbiIgIiR2YWx1ZSIKCWZpCn0KCgojIyBAZm4gX19hcmdzcGFyc2VfcGFyc2Vfb3B0aW9uc19lbnZfYW5kX2RlZmF1bHRzKCkKIyMgQGJyaWVmIHNldCBvcHRpb25zIGZyb20gZW52aXJvbm1lbnQgYW5kIGZyb20gZGVmYXVsdCB2YWx1ZXMuCiMjIEBkZXRhaWxzCiMjIEZvciBldmVyeSBvcHRpb24gdGhhdCBoYXZlIG5vdCBiZWVuIHNldCBmcm9tIGNvbW1hbmQgbGluZSwgbG9vayBmb3IKIyMgYSBtYXRjaGluZyBlbnZpcm9ubWVudCB2YXJpYWJsZSAod2hlbgojIyBhcmdzcGFyc2VfYXJlX2Vudmlyb25tZW50X3ZhcmlhYmxlc19lbmFibGVkKCkgaXMgdHJ1ZSkgYW5kIGFwcGx5CiMjIGRlZmF1bHQgdmFsdWVzIHJpZ2h0IGFmdGVyIGlmIHN0aWxsIGxlZnQgdW5zZXQuCiMjIEBwcml2YXRlCl9fYXJnc3BhcnNlX3BhcnNlX29wdGlvbnNfZW52X2FuZF9kZWZhdWx0cygpIHsKCWxvY2FsIG9wdGlvbiB2YWx1ZQoJZm9yIG9wdGlvbiBpbiAiJHshX19hcmdzcGFyc2Vfb3B0aW9uc19kZXNjcmlwdGlvbnNbQF19IgoJZG8KCQlpZiAhIGFyZ3NwYXJzZV9pc19vcHRpb25fc2V0ICIkb3B0aW9uIgoJCXRoZW4KCQkJaWYgYXJnc3BhcnNlX2FyZV9lbnZpcm9ubWVudF92YXJpYWJsZXNfZW5hYmxlZCAmJgoJCQkJCXZhbHVlPSQoYXJnc3BhcnNlX29wdGlvbl9lbnZpcm9ubWVudF92YXJpYWJsZSAiJG9wdGlvbiIpCgkJCXRoZW4KCQkJCWFyZ3NwYXJzZV9zZXRfb3B0aW9uX2Zyb21fZW52aXJvbm1lbnRfdmFsdWUgIiRvcHRpb24iICIkdmFsdWUiCgkJCWVsaWYgX19hcmdzcGFyc2VfaGFzX2FycmF5X2l0ZW0gXAoJCQkJCSBfX2FyZ3NwYXJzZV9vcHRpb25zX2RlZmF1bHRfdmFsdWVzICIkb3B0aW9uIgoJCQl0aGVuCgkJCQkgYXJnc3BhcnNlX3NldF9vcHRpb24gIiRvcHRpb24iIFwKCQkJCQkiJHtfX2FyZ3NwYXJzZV9vcHRpb25zX2RlZmF1bHRfdmFsdWVzWyRvcHRpb25dfSIKCQkJZmkKCQlmaQoJZG9uZQp9CgoKIyMgQHZhciBBc3NvY2lhdGl2ZUFycmF5IHByb2dyYW1fb3B0aW9ucwojIyBAYnJpZWYgT3B0aW9ucyB2YWx1ZXMuCiMjIEBkZXRhaWxzCiMjIEFmdGVyIGFyZ3NwYXJzZV9wYXJzZV9vcHRpb25zKCksIGl0IHdpbGwgY29udGFpbiAoaWYgbm8gaG9vayBpcyBzZXQKIyMgZm9yICJvcHRpb25uYW1lIikKIyMgLSAib3B0aW9ubmFtZSIgLT4gInZhbHVlIiwgaWYgIm9wdGlvbm5hbWUiIGFjY2VwdHMgYSB2YWx1ZS4KIyMgLSAib3B0aW9ubmFtZSIgLT4gImhvdyBtYW55IHRpbWVzIHRoZSBvcHRpb24gaGFzIGJlZW4gZGV0ZWN0ZWQgb24KIyMgLgojIyB0aGUgY29tbWFuZCBsaW5lIiwgZWxzZS4KZGVjbGFyZSAtQSBwcm9ncmFtX29wdGlvbnM9KCkKCgojIyBAdmFyIEFycmF5IHByb2dyYW1fcGFyYW1zCiMjIEBicmllZiBQb3NpdGlvbm5hbCBwYXJhbWV0ZXJzIG9mIHRoZSBzY3JpcHQKIyMgQGRldGFpbHMKIyMgQWZ0ZXIgYXJnc3BhcnNlX3BhcnNlX29wdGlvbnMoKSwgaXQgd2lsbCBjb250YWluIGFsbCBub24tb3B0aW9uCiMjIHBhcmFtZXRlcnMuIChUeXBpY2FsbHksIGV2ZXJ5dGhpbmcgZm91bmQgYWZ0ZXIgdGhlICctLScpCmRlY2xhcmUgLWEgcHJvZ3JhbV9wYXJhbXM9KCkKCgojIyBAdmFyIEFzc29jaWF0aXZlQXJyYXkgX19hcmdzcGFyc2VfdG1wX2lkZW50aWZpZXJzCiMjIEBwcml2YXRlCiMjIEBicmllZiBJbnRlcm5hbCB1c2UKIyMgQGRldGFpbHMKIyMgVXNlZCB0byB2ZXJpZnkgZGVjbGFyZWQgb3B0aW9ucyBkbyBub3QgY29uZmxpY3QuIElzIHVuc2V0IGFmdGVyCiMjIGFyZ3NwYXJzZV9wYXJzZV9vcHRpb25zKCkgYmVpbmcgY2FsbGVkLgpkZWNsYXJlIC1BIF9fYXJnc3BhcnNlX3RtcF9pZGVudGlmaWVycz0oKQoKCl9fYXJnc3BhcnNlX2NoZWNrX3JlcXVpcmVzKCkgewoJIyBAcmV0dXJuIHRoZSBudW1iZXIgb2YgbWlzc2luZyBvcHRpb24gZGV0ZWN0ZWQsIGJ1dCB0aGlzIGZ1bmN0aW9uCgkjIGFjdHVhbGx5IHN0b3BzIGFyZSB0aGUgZmlyc3QgZmFpbGluZyAqbGlzdCogb2YgZGVwZW5kZW5jaWVzLgoJbG9jYWwgb3B0aW9uCglsb2NhbCByZXF1aXJlc3RyaW5nIHJlcXVpcmUgY291bnQ9MAoJbG9jYWwgLWEgcmVxdWlyZXMKCWZvciBvcHRpb24gaW4gIiR7IXByb2dyYW1fb3B0aW9uc1tAXX0iCglkbwoJCWlmICEgcmVxdWlyZXN0cmluZz0iJChhcmdzcGFyc2VfaGFzX29wdGlvbl9wcm9wZXJ0eSAiJG9wdGlvbiIgcmVxdWlyZSkiCgkJdGhlbgoJCQkjIE5vIHJlcXVpcmVtZW50IGZvciB0aGlzIG9wdGlvbi4KCQkJY29udGludWUKCQlmaQoJCXJlYWQgLWEgcmVxdWlyZXMgPDw8IiRyZXF1aXJlc3RyaW5nIgoJCWZvciByZXF1aXJlIGluICIke3JlcXVpcmVzW0BdfSIKCQlkbwoJCQlpZiAhIGFyZ3NwYXJzZV9pc19vcHRpb25fc2V0ICIkcmVxdWlyZSIKCQkJdGhlbgoJCQkJcHJpbnRmID4mMiAiJXM6IC0tJXM6IHJlcXVpcmVzIG9wdGlvbiAtLSVzLlxuIiBcCgkJCQkJIiRhcmdzcGFyc2VfcGdtIiAiJG9wdGlvbiIgIiRyZXF1aXJlIgoJCQkJOiAkKChjb3VudCsrKSkKCQkJZmkKCQlkb25lCgkJW1sgIiRjb3VudCIgLW5lIDAgXV0gJiYgcmV0dXJuICIkY291bnQiCglkb25lCglyZXR1cm4gMAp9CgpfX2FyZ3NwYXJzZV9jaGVja19taXNzaW5nX29wdGlvbnMoKSB7CgkjIEByZXR2YWwgMCBpZiBhbGwgbWFuZGF0b3J5IG9wdGlvbnMgaGF2ZSBhIHZhbHVlIGluCgkjIHByb2dyYW1fb3B0aW9ucyBhc3NvY2lhdGl2ZSBhcnJheS4KCWxvY2FsIG9wdGlvbiBjb3VudD0wCglmb3Igb3B0aW9uIGluICIkeyFfX2FyZ3NwYXJzZV9vcHRpb25zX2Rlc2NyaXB0aW9uc1tAXX0iCglkbwoJCWFyZ3NwYXJzZV9oYXNfb3B0aW9uX3Byb3BlcnR5ICIkb3B0aW9uIiBtYW5kYXRvcnkgfHwgY29udGludWUKCQkjIElmIG9wdGlvbiBoYXMgYmVlbiBnaXZlbiwganVzdCBpdGVyYXRlLgoJCWFyZ3NwYXJzZV9pc19vcHRpb25fc2V0ICIkb3B0aW9uIiAmJiBjb250aW51ZQoJCXByaW50ZiA+JjIgIiVzOiAtLSVzOiBvcHRpb24gaXMgbWFuZGF0b3J5LlxuIiBcCgkJCSIkYXJnc3BhcnNlX3BnbSIgIiRvcHRpb24iCgkJOiAkKChjb3VudCsrKSkKCWRvbmUKCVtbICIkY291bnQiIC1lcSAwIF1dCn0KCgpfX2FyZ3NwYXJzZV9wYXJzZV9vcHRpb25zX3ByZXBhcmVfZXhjbHVkZSgpIHsKCSMgQ2hlY2sgZm9yIGFsbCAiZXhjbHVkZSIgcHJvcGVydGllcywgYW5kIGZpbGwgImV4Y2x1c2lvbnMiCgkjIGFzc29jaWF0aXZlIGFycmF5LCB3aGljaCBzaG91bGQgaGF2ZSBiZWVuIGRlY2xhcmVkIGluCgkjIF9fYXJnc3BhcnNlX3BhcnNlX29wdGlvbnNfbm9fdXNhZ2UuCglsb2NhbCBvcHRpb24gZXhjbHVkZSBleGNsdWRlc3RyaW5nCglsb2NhbCAtYSBleGNsdWRlcwoJZm9yIG9wdGlvbiBpbiAiJHshX19hcmdzcGFyc2Vfb3B0aW9uc19kZXNjcmlwdGlvbnNbQF19IgoJZG8KCQlleGNsdWRlc3RyaW5nPSQoYXJnc3BhcnNlX2hhc19vcHRpb25fcHJvcGVydHkgIiRvcHRpb24iIGV4Y2x1ZGUpIHx8IFwKCQkJY29udGludWUKCQlleGNsdXNpb25zWyIkb3B0aW9uIl0rPSIke2V4Y2x1c2lvbnNbIiRvcHRpb24iXTorIH0kZXhjbHVkZXN0cmluZyIKCQkjIFJlLXNwbGl0IHRoZSBzdHJpbmcuICh3aXRob3V0IGludm9sdmluZyBhbnl0aGluZyBlbHNlKQoJCXJlYWQgLWEgZXhjbHVkZXMgPDw8IiRleGNsdWRlc3RyaW5nIgoJCWZvciBleGNsdWRlIGluICIke2V4Y2x1ZGVzW0BdfSIKCQlkbwoJCQlleGNsdXNpb25zWyIkZXhjbHVkZSJdKz0iJHtleGNsdXNpb25zWyIkZXhjbHVkZSJdOisgfSRvcHRpb24iCgkJZG9uZQoJZG9uZQp9CgoKX19hcmdzcGFyc2VfcGFyc2Vfb3B0aW9uc19jaGVja19leGNsdXNpb25zKCkgewoJIyBDaGVjayBpZiB0d28gb3B0aW9ucyBwcmVzZW50cyBvbiB0aGUgY29tbWFuZCBsaW5lIGFyZSBtdXR1YWxseQoJIyBleGNsdXNpdmUuIFByaW50cyB0aGUgIm90aGVyIiBvcHRpb24gaWYgaXQncyB0aGUgY2FzZS4KCSMgQHBhcmFtIGFuIG9wdGlvbgoJIyBAcmV0dXJuIDAgaWYgdGhlIGdpdmVuIG9wdGlvbiBoYXMgYWN0dWFsbHkgZXhjbHVkZWQgYnkgYW5ub3RoZXIKCSMgYWxyZWFkeS1naXZlbiBvcHRpb24uCglbWyAkIyAtZXEgMSBdXSB8fCByZXR1cm4gMQoJbG9jYWwgbmV3X29wdGlvbj0kMQoJbG9jYWwgb3B0aW9uCgoJZm9yIG9wdGlvbiBpbiAiJHshcHJvZ3JhbV9vcHRpb25zW0BdfSIKCWRvCgkJaWYgW1sgIiR7ZXhjbHVzaW9uc1siJG9wdGlvbiJdLX0iID1+IF4oLiogKT8iJG5ld19vcHRpb24iKCAuKik/JCBdXQoJCXRoZW4KCQkJcHJpbnRmICVzICIkb3B0aW9uIgoJCQlyZXR1cm4gMAoJCWZpCglkb25lCglyZXR1cm4gMQp9CgoKIyMgQGZuIF9fYXJnc3BhcnNlX3NldF9vcHRpb24oKQojIyBAcHJpdmF0ZQojIyBAYnJpZWYgUmVzb2x2IG9wdGlvbi1zcGVjaWZpYyBzZXR0ZXIgZnVuY3Rpb24gYW5kIGludm9rZSBpdC4KIyMgQGRldGFpbHMgQ2hlY2sgaWYgYSB1c2VyLWRlZmluZWQgb3B0aW9uIHNldHRpbmcgZnVuY3Rpb24KIyMgKHNldF9vcHRpb25fPG9wdGlvbm5hbWU+KSBoYXMgYmVlbiBkZWZpbmVkIG9yIGlmIHRoZSBnZW5lcmljCiMjIGFyZ3NwYXJzZV9zZXRfb3B0aW9uKCkgZnVuY3Rpb24gaXMgdG8gYmUgdXNlZC4gVGhlbiBpbnZva2UgdGhlIHRoYXQKIyMgZnVuY3Rpb24gd2l0aCB0aGUgb3B0aW9uIG5hbWUgYXMgZmlyc3QgcGFyYW1ldGVyLiBJZiBhIHZhbHVlIGZvcgojIyB0aGUgb3B0aW9uIGlzIGludm9sdmVkLCBpdCBpcyBwYXNzZWQgYXMgYSBzZWNvbmQgcGFyYW1ldGVyLgojIyBAcGFyYW0gb3B0aW9uIGFuIG9wdGlvbiBuYW1lLgojIyBAcmV0dXJuIHRoZSBzZXR0ZXIgZnVuY3Rpb24gcmV0dXJuIGNvZGUKIyMgQGluZ3JvdXAgQXJnc3BhcnNlT3B0aW9uU2V0dGVyCl9fYXJnc3BhcnNlX3NldF9vcHRpb24oKSB7CglbWyAkIyAtZXEgMSB8fCAkIyAtZXEgMiBdXSB8fCByZXR1cm4gMQoJbG9jYWwgb3B0aW9uPSQxCglsb2NhbCBzZXRfaG9vayBpZGVudGlmaWVyCglbWyAkIyAtbmUgMiBdXSB8fCBsb2NhbCB2YWx1ZT0kMgoJIyBUaGUgImlkZW50aWZpZXIgc3RyaW5nIiBtYXRjaGluZyBuZXh0X3BhcmFtLCBzdWl0YWJsZSBmb3IKCSMgdmFyaWFibGUgb3IgZnVuY3Rpb24gbmFtZXMuCglpZGVudGlmaWVyPSIkKGFyZ3NwYXJzZV9vcHRpb25fdG9faWRlbnRpZmllciAiJG9wdGlvbiIpIgoJIyBJZiB1c2VyIGhhcyBkZWZpbmVkIGEgc3BlY2lmaWMgc2V0dGluZyBob29rIGZvciBnaXZlbiB0aGUKCSMgb3B0aW9uLCB0aGVuIHVzZSBpdCwgZWxzZSB1c2UgZGVmYXVsdCBzdGFuZGFyZAoJIyBvcHRpb24tc2V0dGluZyBmdW5jdGlvbi4KCWlmIGRlY2xhcmUgLWYgInNldF9vcHRpb25fJGlkZW50aWZpZXIiID4vZGV2L251bGwgMj4mMQoJdGhlbgoJCXNldF9ob29rPSJzZXRfb3B0aW9uXyRpZGVudGlmaWVyIgoJZWxzZQoJCXNldF9ob29rPWFyZ3NwYXJzZV9zZXRfb3B0aW9uCglmaQoJIyBJbnZva2Ugc2V0dGluZyBob29rLCBhbmQgaWYgaXQgcmV0dXJucyBzb21lIG5vbi16ZXJvIHN0YXR1cywKCSMgc2VuZCB0aGUgdXNlciBiYWNrIHRvIHVzYWdlLCBpZiBkZWNsYXJlZCwgYW5kIHJldHVybiB3aXRoIGVycm9yLgoJIyBUaGUgc3BlY2lmaWMgJHZhbHVlIHN1YnN0aXR1dGlvbiwgaGVyZSwgaXMgdG8gZGlzdGluZ3Vpc2ggYW4KCSMgZW1wdHkgdmFsdWUgZnJvbSBhIG5vLXZhbHVlLgoJIiRzZXRfaG9vayIgIiRvcHRpb24iICR7dmFsdWUrIiR2YWx1ZSJ9Cn0KCgojIyBAZm4gX19hcmdzcGFyc2VfcGFyc2Vfb3B0aW9uc192YWx1ZWNoZWNrKCkKIyMgQHByaXZhdGUKIyMgQGJyaWVmIENoZWNrIGEgdmFsdWUgZ2l2ZW4gdG8gYW4gb3B0aW9uLgojIyBAZGV0YWlscyBJZiBhbiBlbnVtZXJhdGlvbiBoYXMgYmVlbiBkZWZpbmVkIGZvciB0aGUgb3B0aW9uLCBjaGVjawojIyBhZ2FpbnN0IHRoYXQuIElmIHRoZXJlJ3Mgbm8gZW51bWVyYXRpb24sIGJ1dCBvcHRpb24gaGFzIGEgdHlwZQojIyBwcm9wZXJ0eSwgdGhlbiBjaGVjayBhZ2FpbnN0IHRoZSB0eXBlLiBJbiB0aGUgZW5kLCBjaGVjayBhZ2FpbnN0CiMjIGNoZWNrX3ZhbHVlX29mXzxvcHRpb24+IGZ1bmN0aW9uLCBpZiBpdCdzIGJlZW4gZGVmaW5lZC4KIyMgQHBhcmFtIG9wdGlvbiBhbiBvcHRpb24gbmFtZS4KIyMgQHBhcmFtIHZhbHVlIGFueXRoaW5nLgojIyBAcmV0dmFsIDAgaWYgdmFsdWUgaXMgY29ycmVjdCBmb3IgZ2l2ZW4gb3B0aW9uLgojIyBAaW5ncm91cCBBcmdzcGFyc2VPcHRpb25UeXBpbmcKX19hcmdzcGFyc2VfcGFyc2Vfb3B0aW9uc192YWx1ZWNoZWNrKCkgewoJW1sgJCMgLWVxIDIgXV0gfHwgcmV0dXJuIDEKCWxvY2FsIG9wdGlvbj0kMQoJbG9jYWwgdmFsdWU9JDIKCWxvY2FsIGlkZW50aWZpZXIgcG9zc2libGVfdmFsdWVzIG9wdGlvbl90eXBlCglpZGVudGlmaWVyPSIkKGFyZ3NwYXJzZV9vcHRpb25fdG9faWRlbnRpZmllciAiJG9wdGlvbiIpIgoJaWYgcG9zc2libGVfdmFsdWVzPSQoX19hcmdzcGFyc2VfdmFsdWVzX2FycmF5X2lkZW50aWZpZXIgIiRvcHRpb24iKQoJdGhlbgoJCV9fYXJnc3BhcnNlX2luZGV4X29mICIkdmFsdWUiICIkeyFwb3NzaWJsZV92YWx1ZXN9IiA+L2Rldi9udWxsIHx8IFwKCQkJcmV0dXJuIDEKCWVsaWYgb3B0aW9uX3R5cGU9JChhcmdzcGFyc2VfaGFzX29wdGlvbl9wcm9wZXJ0eSAiJG9wdGlvbiIgdHlwZSkKCXRoZW4KCQlhcmdzcGFyc2VfY2hlY2tfb3B0aW9uX3R5cGUgIiRvcHRpb25fdHlwZSIgIiR2YWx1ZSIgfHwgcmV0dXJuIDEKCWZpCglpZiBkZWNsYXJlIC1mICJjaGVja192YWx1ZV9vZl8kaWRlbnRpZmllciIgPi9kZXYvbnVsbCAyPiYxCgl0aGVuCgkJImNoZWNrX3ZhbHVlX29mXyRpZGVudGlmaWVyIiAiJHZhbHVlIiB8fCByZXR1cm4gMQoJZmkKCXJldHVybiAwCn0KCiMjIEBmbiBfX2FyZ3NwYXJzZV9wYXJzZV9vcHRpb25zX25vX3VzYWdlKCkKIyMgQGJyaWVmIFBhcnNlIG9wdGlvbnMgd2l0aG91dCB0cmlnZ2VyaW5nIHVzYWdlCl9fYXJnc3BhcnNlX3BhcnNlX29wdGlvbnNfbm9fdXNhZ2UoKSB7CgkjIFRoaXMgZnVuY3Rpb24gcmUtc2V0IHByb2dyYW1fcGFyYW1zIGFycmF5IHZhbHVlcy4gVGhpcyBmdW5jdGlvbgoJIyB3aWxsIGFsc28gbW9kaWZ5IHRoZSBwcm9ncmFtX29wdGlvbnMgYXNzb2NpYXRpdmUgYXJyYXkuCgkjIElmIGFueSBlcnJvciBoYXBwZW5zLCB0aGlzIGZ1bmN0aW9uIHdpbGwgcmV0dXJuIDEuCgoJIyBCZSBjYXJlZnVsLCB0aGUgZnVuY3Rpb24gaXMgKHRvbykgYmlnLgoKCWxvY2FsIGxvbmcgc2hvcnQgZ2V0b3B0X3RlbXAgbmV4dF9wYXJhbSBzZXRfaG9vayBvcHRpb25fdHlwZQoJbG9jYWwgbmV4dF9wYXJhbV9pZGVudGlmaWVyIGV4Y2x1ZGUgdmFsdWUgY2hhcgoJbG9jYWwgLWEgbG9uZ3NfYXJyYXkKCWxvY2FsIC1BIGV4Y2x1c2lvbnMKCSMgVGhlIGdldG9wdCBwYXJhbWV0ZXJzLgoJbG9jYWwgbG9uZ3Mgc2hvcnRzIG9wdGlvbgoKCSMgTm8gYXJndW1lbnQgc2VuZHMgYmFjayB0byB1c2FnZSwgaWYgZGVmaW5lZC4KCWlmIFtbICQjIC1lcSAwICYmICIkX19hcmdzcGFyc2VfYWxsb3dfbm9fYXJndW1lbnQiICE9IHllcyBdXQoJdGhlbgoJCXJldHVybiAxCglmaQoKCSMgMS4gQW5hbHl6ZSBkZWNsYXJlZCBvcHRpb25zIHRvIGNyZWF0ZSBnZXRvcHQgdmFsaWQgYXJndW1lbnRzLgoJZm9yIGxvbmcgaW4gIiR7IV9fYXJnc3BhcnNlX29wdGlvbnNfZGVzY3JpcHRpb25zW0BdfSIKCWRvCgkJaWYgYXJnc3BhcnNlX2hhc19vcHRpb25fcHJvcGVydHkgIiRsb25nIiB2YWx1ZQoJCXRoZW4KCQkJbG9uZ3NfYXJyYXkrPSggIiRsb25nOiIgKQoJCWVsc2UKCQkJbG9uZ3NfYXJyYXkrPSggIiRsb25nIiApCgkJZmkKCWRvbmUKCgkjIDIuIENyZWF0ZSB0aGUgbG9uZyBvcHRpb25zIHN0cmluZy4KCWxvbmdzPSIkKF9fYXJnc3BhcnNlX2pvaW5fYXJyYXkgLCAiJHtsb25nc19hcnJheVtAXX0iKSIKCgkjIDMuIENyZWF0ZSB0aGUgc2hvcnQgb3B0aW9uIHN0cmluZy4KCWZvciBzaG9ydCBpbiAiJHshX19hcmdzcGFyc2Vfc2hvcnRfb3B0aW9uc1tAXX0iCglkbwoJCWlmIGFyZ3NwYXJzZV9oYXNfb3B0aW9uX3Byb3BlcnR5IFwKCQkJIiR7X19hcmdzcGFyc2Vfc2hvcnRfb3B0aW9uc1skc2hvcnRdfSIgdmFsdWUKCQl0aGVuCgkJCXNob3J0cys9IiRzaG9ydDoiCgkJZWxzZQoJCQlzaG9ydHMrPSRzaG9ydAoJCWZpCglkb25lCgoJIyA0LiBJbnZva2UgZ2V0b3B0IGFuZCByZXBsYWNlIGFyZ3VtZW50cy4KCWlmICEgZ2V0b3B0X3RlbXA9JChnZXRvcHQgLXMgYmFzaCAtbiAiJGFyZ3NwYXJzZV9wZ20iIFwKCQktLWxvbmdvcHRpb25zPSIkbG9uZ3MiICIkc2hvcnRzIiAiJEAiKQoJdGhlbgoJCSMgU3ludGF4IGVycm9yIG9uIHRoZSBjb21tYW5kIGltcGxpZXMgcmV0dXJuaW5nIHdpdGggZXJyb3IuCgkJcmV0dXJuIDEKCWZpCglldmFsIHNldCAtLSAiJGdldG9wdF90ZW1wIgoKCSMgNS4gUHJlcGFyZSBleGNsdXNpb25zIHN0dWZmLgoJX19hcmdzcGFyc2VfcGFyc2Vfb3B0aW9uc19wcmVwYXJlX2V4Y2x1ZGUKCgkjIDYuIEFyZ3VtZW50cyBwYXJzaW5nIGlzIHJlYWxseSBtYWRlIGhlcmUuCgl3aGlsZSBbWyAkIyAtZ2UgMSBdXQoJZG8KCQluZXh0X3BhcmFtPSQxCgkJc2hpZnQKCQkjIFRoZSByZWd1bGFyIGV4aXQgY2FzZS4KCQlpZiBbWyAiJG5leHRfcGFyYW0iID0gLS0gXV0KCQl0aGVuCgkJCSMgQ2hlY2sgaG93IG1hbnkgcGFyYW1ldGVycyB3ZSBoYXZlIGFuZCBpZiBpdCdzIGF0IGxlYXN0CgkJCSMgd2hhdCB3ZSBleHBlY3RzLgoJCQlpZiBbWyAkIyAtbHQgIiRfX2FyZ3NwYXJzZV9taW5pbXVtX3BhcmFtZXRlcnMiIF1dCgkJCXRoZW4KCQkJCXByaW50ZiA+JjIgXAoJCQkJCSIlczogbm90IGVub3VnaCBwYXJhbWV0ZXJzIChhdCBsZWFzdCAlZCBleHBlY3RlZCwgJWQgcHJvdmlkZWQpXG4iIFwKCQkJCQkiJGFyZ3NwYXJzZV9wZ20iICIkX19hcmdzcGFyc2VfbWluaW11bV9wYXJhbWV0ZXJzIiAkIwoJCQkJcmV0dXJuIDEKCQkJZWxpZiBbWyAkIyAtZ3QgIiRfX2FyZ3NwYXJzZV9tYXhpbXVtX3BhcmFtZXRlcnMiIF1dCgkJCXRoZW4KCQkJCXByaW50ZiA+JjIgXAoJCQkJCSIlczogdG9vIG1hbnkgcGFyYW1ldGVycyAobWF4aW11bSBhbGxvd2VkIGlzICVkLCAlZCBwcm92aWRlZClcbiIgXAoJCQkJCSIkYXJnc3BhcnNlX3BnbSIgIiRfX2FyZ3NwYXJzZV9tYXhpbXVtX3BhcmFtZXRlcnMiICQjCgkJCQlyZXR1cm4gMQoJCQlmaQoJCQkjIFNhdmUgcHJvZ3JhbSBwYXJhbWV0ZXJzIGluIGFycmF5CgkJCXByb2dyYW1fcGFyYW1zPSggIiRAIiApCgoJCQkjIFJldHJpZXZlIHZhbHVlcyBmcm9tIGVudmlyb25tZW50IGFuZCBzZXQgbWF0Y2hpbmcgb3B0aW9ucwoJCQlfX2FyZ3NwYXJzZV9wYXJzZV9vcHRpb25zX2Vudl9hbmRfZGVmYXVsdHMKCgkJCSMgSWYgc29tZSBtYW5kYXRvcnkgb3B0aW9uIGhhdmUgYmVlbiBvbWl0ZWQgYnkgdGhlIHVzZXIsIHRoZW4KCQkJIyBwcmludCBzb21lIGVycm9yLCBhbmQgaW52b2tlIHVzYWdlLgoJCQkjIEFsc28gY2hlY2tzIHJlcXVpcmVzIGNoYWlucy4KCQkJX19hcmdzcGFyc2VfY2hlY2tfbWlzc2luZ19vcHRpb25zICYmIF9fYXJnc3BhcnNlX2NoZWNrX3JlcXVpcmVzCgkJCXJldHVybgoJCWZpCgkJIyBJZiBhIHNob3J0IG9wdGlvbiB3YXMgZ2l2ZW4sIHRoZW4gd2UgZmlyc3QgY29udmVydCBpdCB0byBpdHMKCQkjIG1hdGNoaW5nIGxvbmcgbmFtZS4KCQlpZiBbWyAiJG5leHRfcGFyYW0iID0gLVshLV0gXV0KCQl0aGVuCgkJCWNoYXI9JHtuZXh0X3BhcmFtIy19CgkJCWlmICEgbmV4dF9wYXJhbT0kKGFyZ3NwYXJzZV9zaG9ydF90b19sb25nICIkY2hhciIpCgkJCXRoZW4KCQkJCSMgU2hvcnQgb3B0aW9uIHdpdGhvdXQgZXF1aXZhbGVudCBsb25nLiBBY2NvcmRpbmcgdG8KCQkJCSMgY3VycmVudCBpbXBsZW1lbnRhdGlvbiwgdGhpcyBzaG91bGQgYmUgY29uc2lkZXJlZCBhcwoJCQkJIyBhIGJ1Zy4KCQkJCXByaW50ZiA+JjIgXAoJCQkJCSIlczogLSVzOiBvcHRpb24gZG9lc250IGhhdmUgYW55IG1hdGNoaW5nIGxvbmcgb3B0aW9uLiIgXAoJCQkJCSIkYXJnc3BhcnNlX3BnbSIgIiRjaGFyIgoJCQkJcmV0dXJuIDEKCQkJZmkKCQllbHNlCgkJCSMgV2FzbnQgYSBzaG9ydCBvcHRpb24uIEp1c3Qgc3RyaXAgdGhlIGxlYWRpbmcgZGFzaC4KCQkJbmV4dF9wYXJhbT0ke25leHRfcGFyYW0jLS19CgkJZmkKCQlpZiBleGNsdWRlPSQoX19hcmdzcGFyc2VfcGFyc2Vfb3B0aW9uc19jaGVja19leGNsdXNpb25zICIkbmV4dF9wYXJhbSIpCgkJdGhlbgoJCQlwcmludGYgPiYyIFwKCQkJCSIlczogJXM6IG9wdGlvbiBleGNsdWRlZCBieSBvdGhlciBvcHRpb24gKCVzKS5cbiIgXAoJCQkJIiRhcmdzcGFyc2VfcGdtIiAiJG5leHRfcGFyYW0iICIkZXhjbHVkZSIKCQkJcmV0dXJuIDEKCQlmaQoJCSMgU2V0IG9wdGlvbiB2YWx1ZSwgaWYgdGhlcmUgc2hvdWxkIGJlIG9uZS4KCQlpZiBhcmdzcGFyc2VfaGFzX29wdGlvbl9wcm9wZXJ0eSAiJG5leHRfcGFyYW0iIHZhbHVlCgkJdGhlbgoJCQl2YWx1ZT0kMQoJCQlzaGlmdAoJCQlpZiAhIF9fYXJnc3BhcnNlX3BhcnNlX29wdGlvbnNfdmFsdWVjaGVjayAiJG5leHRfcGFyYW0iICIkdmFsdWUiCgkJCXRoZW4KCQkJCXByaW50ZiA+JjIgIiVzOiAlczogSW52YWxpZCB2YWx1ZSBmb3Igb3B0aW9uICVzLlxuIiBcCgkJCQkJIiRhcmdzcGFyc2VfcGdtIiAiJHZhbHVlIiAiJG5leHRfcGFyYW0iCgkJCQlyZXR1cm4gMQoJCQlmaQoJCWZpCgkJIyBJbnZva2Ugc2V0dGluZyBob29rLCBhbmQgaWYgaXQgcmV0dXJucyByZXR1cm5zIHNvbWUgbm9uLXplcm8KCQkjIHN0YXR1cywgc2VuZCB0aGUgdXNlciBiYWNrIHRvIHVzYWdlLCBpZiBkZWNsYXJlZCwgYW5kIHJldHVybgoJCSMgd2l0aCBlcnJvci4KCQkjIFRoZSBzcGVjaWZpYyAkdmFsdWUgc3Vic3RpdHV0aW9uLCBoZXJlLCBpcyB0byBkaXN0aW5ndWlzaCBhbgoJCSMgZW1wdHkgdmFsdWUgZnJvbSBhIG5vLXZhbHVlLgoJCWlmICEgX19hcmdzcGFyc2Vfc2V0X29wdGlvbiAiJG5leHRfcGFyYW0iICR7dmFsdWUrIiR2YWx1ZSJ9CgkJdGhlbgoJCQlwcmludGYgPiYyICIlczogJXM6IEludmFsaWQgdmFsdWUgZm9yICVzIG9wdGlvbi5cbiIgXAoJCQkJIiRhcmdzcGFyc2VfcGdtIiAiJHZhbHVlIiAiJG5leHRfcGFyYW0iCgkJCXJldHVybiAxCgkJZmkKCQl1bnNldCB2YWx1ZQoJZG9uZQoJcmV0dXJuIDAKfQoKaWYgW1sgJHtBUkdTUEFSU0VfQ09NUExFVElPTl9NT0RFLX0gXV0KdGhlbgoJc2hvcHQgcHJvZ2NvbXAgZXhwYW5kX2FsaWFzZXMgPi9kZXYvbnVsbCB8fCBleGl0IDEKCWFsaWFzIGFyZ3NwYXJzZV9wYXJzZV9vcHRpb25zPSdyZXR1cm4gMCAyPi9kZXYvbnVsbCB8fCA6JwplbHNlCiMjIEBmbiBhcmdzcGFyc2VfcGFyc2Vfb3B0aW9ucygpCiMjIEBicmllZiBQYXJzZSBwcm9ncmFtIG9wdGlvbnMuCiMjIEBkZXRhaWxzIFRoaXMgZnVuY3Rpb24gd2lsbCBtYWtlIG9wdGlvbiBwYXJzaW5nIGhhcHBlbiwgYW5kIGlmIGFuIGVycm9yCiMjIGlzIGRldGVjdGVkLCB0aGUgdXNhZ2UoKSBmdW5jdGlvbiB3aWxsIGJlIGludm9rZWQsIGlmIGl0IGhhcyBiZWVuCiMjIGRlZmluZWQuIElmIGl0J3Mgbm90IGRlZmluZWQsIHRoZSBmdW5jdGlvbiB3aWxsIHJldHVybiAxLgojIyBQYXJzZSBvcHRpb25zLCBhbmQgcmV0dXJuIGlmIGV2ZXJ5dGhpbmcgd2VudCBmaW5lLgojIyBAcGFyYW0gcGFyYW1ldGVycy4uLiBzaG91bGQgYmUgdGhlIHByb2dyYW0gYXJndW1lbnRzLgojIyBAcmV0dmFsIDAgaWYgdGhlIHdob2xlIG9wdGlvbiBwYXJzaW5nIHByb2Nlc3Mgd2VudCBmaW5lLgojIyBAcmV0dmFsIDEgaWYgYW4gZXJyb3IgaXMgZW5jb3V0ZXJlZCBhbmQgdXNhZ2UgZG9lcyBub3QgcGVyZm9ybSBhbiBleGl0LgphcmdzcGFyc2VfcGFyc2Vfb3B0aW9ucygpIHsKCQl1bnNldCBfX2FyZ3NwYXJzZV90bXBfaWRlbnRpZmllcnMgfHwgOgoJCV9fYXJnc3BhcnNlX3BhcnNlX29wdGlvbnNfbm9fdXNhZ2UgIiRAIiAmJiByZXR1cm4KCQkjIFNvbWV0aGluZyB3ZW50IHdyb25nLCBpbnZva2UgdXNhZ2UgZnVuY3Rpb24sIGlmIGRlZmluZWQuCgkJZGVjbGFyZSAtZiB1c2FnZSA+L2Rldi9udWxsIDI+JjEgJiYgdXNhZ2UKCQlyZXR1cm4gMQp9CmZpCgoKIyMgQGZuIGFyZ3NwYXJzZV9pc19vcHRpb25fc2V0KCkKIyMgQGJyaWVmIFJldHVybiBUcnVlIGlmIGFuIG9wdGlvbiBoYXMgYmVlbiBzZXQgb24gdGhlIGNvbW1hbmQgbGluZS4KIyMgQHBhcmFtIG9wdGlvbiBhbiBvcHRpb24gbmFtZS4KIyMgQHJldHZhbCAwIGlmIGdpdmVuIG9wdGlvbiBoYXMgYmVlbiBzZXQgb24gdGhlIGNvbW1hbmQgbGluZS4KYXJnc3BhcnNlX2lzX29wdGlvbl9zZXQoKSB7CglbWyAkIyAtZXEgMSBdXSB8fCByZXR1cm4gMQoJbG9jYWwgb3B0aW9uPSQxCglbWyAtbiAiJHtwcm9ncmFtX29wdGlvbnNbJG9wdGlvbl0reWVzfSIgXV0KfQoKIyMgQGZuIGFyZ3NwYXJzZV9yZXBvcnQoKQojIyBAYnJpZWYgUHJpbnRzIGEgYmFzaWMgcmVwb3J0IG9mIGFsbCBwYXNzZWQgb3B0aW9ucwojIyBAZGV0YWlscyBLaW5kYSB1c2VmdWwgZm9yIGEgLS1kZWJ1Zywgb3IgYSAtLXZlcmJvc2Ugb3B0aW9uLAojIyB0aGlzIGZ1bmN0aW9uIHdpbGwgcHJpbnQgb3B0aW9ucyBhbmQgdGhlaXIgdmFsdWVzLgojIyBAcGFyYW0gb3B0aW9uLi4uIEEgbGlzdCBvZiBvcHRpb24gbmFtZS4gSWYgb21pdHRlZCBhbGwgb3B0aW9ucwojIyB3aWxsIGJlIGRpc3BsYXllZC4KIyMgQHJldHZhbCAwCmFyZ3NwYXJzZV9yZXBvcnQoKSB7Cglsb2NhbCBvcHRpb24gYXJyYXlfbmFtZSB2YWx1ZQoJbG9jYWwgbGVuZ3RoPSQoX19hcmdzcGFyc2VfbWF4X2xlbmd0aCAiJHshX19hcmdzcGFyc2Vfb3B0aW9uc19kZXNjcmlwdGlvbnNbQF19IikKCWxvY2FsIC1hIGFycmF5IG9wdGlvbnMKCglpZiBfX2FyZ3NwYXJzZV9pc19hcnJheV9kZWNsYXJlZCBfX2FyZ3NwYXJzZV90bXBfaWRlbnRpZmllcnMKCXRoZW4KCQkjIFRoZSB0ZXN0IGlzIGEgYml0IGhhY2t5LCBidXQgaXQgYXZvaWRzIGltcGxlbWVudGluZyBhbm90aGVyCgkJIyBtZWNoYW5pc20uCgkJcHJpbnRmICJhcmdzcGFyc2VfcGFyc2Vfb3B0aW9uIHdhcyBub3QgcmFuIHlldC5cbiIKCWZpCgoJaWYgW1sgJCMgLWVxIDAgXV0KCXRoZW4KCQlvcHRpb25zPSggIiR7IV9fYXJnc3BhcnNlX29wdGlvbnNfZGVzY3JpcHRpb25zW0BdfSIgKQoJZWxzZQoJCW9wdGlvbnM9KCAiJEAiICkKCWZpCglmb3Igb3B0aW9uIGluICIke29wdGlvbnNbQF19IgoJZG8KCQlhcmdzcGFyc2VfaGFzX29wdGlvbl9wcm9wZXJ0eSAiJG9wdGlvbiIgaGlkZGVuICYmIGNvbnRpbnVlCgkJcHJpbnRmICIlLSAke2xlbmd0aH1zXHQ6ICIgIiRvcHRpb24iCgkJaWYgYXJnc3BhcnNlX2lzX29wdGlvbl9zZXQgIiRvcHRpb24iCgkJdGhlbgoJCQlwcmludGYgInllcyAoJXMiICIke3Byb2dyYW1fb3B0aW9uc1skb3B0aW9uXX0iCgkJCWlmIGFyZ3NwYXJzZV9oYXNfb3B0aW9uX3Byb3BlcnR5ICIkb3B0aW9uIiBjdW11bGF0aXZlIHx8IFwKCQkJCWFyZ3NwYXJzZV9oYXNfb3B0aW9uX3Byb3BlcnR5ICIkb3B0aW9uIiBjdW11bGF0aXZlc2V0CgkJCXRoZW4KCQkJCWFycmF5X25hbWU9IiQoYXJnc3BhcnNlX2dldF9jdW11bGF0aXZlX2FycmF5X25hbWUgIiRvcHRpb24iKVtAXSIKCQkJCWFycmF5PSggIiR7IWFycmF5X25hbWV9IiApCgkJCQlwcmludGYgJyB0aW1lKHMpOicKCQkJCWZvciB2YWx1ZSBpbiAiJHthcnJheVtAXX0iCgkJCQlkbwoJCQkJCXByaW50ZiAnICVxJyAiJHZhbHVlIgoJCQkJZG9uZQoJCQlmaQoJCQlwcmludGYgJylcbicKCQllbHNlCgkJCXByaW50ZiAnbm9cbicKCQlmaQoJZG9uZQp9CgoKIyMgQGZuIHVzYWdlKCkKIyMgQGJyaWVmIERlZmF1bHQgdXNhZ2UgZnVuY3Rpb24uCiMjIEBkZXRhaWxzIFRoZSBkZWZhdWx0IHVzYWdlIGZ1bmN0aW9uLiBCeSBkZWZhdWx0LCBpdCB3aWxsIGJlIGNhbGxlZAojIyBieSBhcmdzcGFyc2VfcGFyc2Vfb3B0aW9ucygpIG9uIGVycm9yIG9yIGlmIC0taGVscCBvcHRpb24gcHJvdmlkZWQgYnkKIyMgdXNlciBvbiB0aGUgY29tbWFuZCBsaW5lLiBJdCBjYW4gZWFzaWx5IGJlIG92ZXJ3cml0dGVuIGlmIGl0IGRvZXMgbm90CiMjIHN1aXRzIHlvdXIgbmVlZHMuCiMjIEByZXR1cm4gVGhpcyBmdW5jdGlvbiBtYWtlcyBhbiBAYiBleGl0IHdpdGggY29kZSAxCiMjIEBpbmdyb3VwIEFyZ3NwYXJzZVVzYWdlCnVzYWdlKCkgewoJYXJnc3BhcnNlX3VzYWdlCglleGl0IDEKfQoKIyMgQGZuIHNldF9vcHRpb25faGVscCgpCiMjIEBicmllZiBEZWZhdWx0IHRyaWdnZXIgZm9yIC0taGVscCBvcHRpb24uCiMjIEBkZXRhaWxzIFdpbGwgYWN0dWFsbHkgb25seSBjYWxsIHVzYWdlKCkuCiMjIEByZXR1cm4gV2hhdGV2ZXIgdXNhZ2UoKSByZXR1cm5zLgojIyBAaW5ncm91cCBBcmdzcGFyc2VVc2FnZQpzZXRfb3B0aW9uX2hlbHAoKSB7CgkjIFRoaXMgaXMgdGhlIGRlZmF1bHQgaG9vayBmb3IgdGhlIC0taGVscCBvcHRpb24uCgl1c2FnZQp9CgojIFdlIGRvIGRlZmluZSBhIGRlZmF1bHQgLS1oZWxwIG9wdGlvbi4KYXJnc3BhcnNlX3VzZV9vcHRpb24gIj1oZWxwIiAiU2hvdyB0aGlzIGhlbHAgbWVzc2FnZSIKCgpyZXR1cm4gMCA+L2Rldi9udWxsIDI+JjEgfHw6CgpwcmludGYgIlRoZSAlcyBmaWxlIGlzIG5vdCBhIHN0YW5kYWxvbmUgcHJvZ3JhbS4gSXQncyBhIHNoZWxsIGxpYnJhcnkuXG4iIFwKCSIkYXJnc3BhcnNlX3BnbSIKcHJpbnRmICIlc1xuIiBcCgkiVG8gdXNlIGl0LCB5b3UgaGF2ZSB0byBsb2FkIGl0IGluIHlvdXIgb3duIGJhc2giIFwKCSJzaGVsbCBzY3JpcHRzIHVzaW5nIHRoZSBmb2xsb3dpbmcgbGluZToiCnByaW50ZiAiXG4uICVxXG5cbiIgIiQwIgo="

SCRIPT_PATH=$(dirname $(readlink -f $0))

echo $argparse | base64 -d >> $SCRIPT_PATH/argsparse.sh

source $SCRIPT_PATH/argsparse.sh

clean_up() {
    if [[ $IS_DEBUG == "n" ]]; then
        rm -f fatpart.raw
        rm -f fdisk_cmd
        rm -f mtools.conf
        rm -f $SCRIPT_PATH/argsparse.sh
    fi
}
trap clean_up EXIT

argsparse_use_option debug "enable debug(set to y for debug)" short:d value default:"n"
argsparse_use_option out "out image" short:o value default:"./sd.img"
argsparse_use_option sdsz "card size in mb" short:s value type:int default:"20"
argsparse_use_option parts "prtition specification (colon-separated), format <part id>:<part no>:<size in MB>:<files space seperated>" short:p cumulative

argsparse_parse_options "$@"  || { usage; exit 1; }

IS_DEBUG="${program_options[debug]}"
IMG_FILE="${program_options[out]}"
IMG_SIZE_MB="${program_options[sdsz]}"

IMG_FIP=""
PTYPE=""
PNO=""
PSIZE=""
PFILES=""

list_files() {
    # Loop over all provided arguments
    for arg in "$@"; do
        # Expand globs manually using 'eval set --'
        eval "matches=($arg)"
        # If no match, treat it as literal (e.g., file with special chars)
        if [ ${#matches[@]} -eq 0 ]; then
            echo "$arg"
            continue
        fi
        # Print all expanded matches
        for f in "${matches[@]}"; do
            echo "$f"
        done
    done
}

get_parts() {
    local old_ifs="$IFS"
    IFS=':'
    # split into positional parameters
    set -- $1
    IFS="$old_ifs"

    #a2:1:64:files
    PTYPE=$1
    PNO=$2
    PSIZE=$3
    PFILES="$4"
}

total_size=0
declare -A partitions
declare -A partitions_file_list

if argsparse_is_option_set parts; then
    count=${program_options[parts]}   # number of occurrences
    for spec in "${cumulated_values_parts[@]}"; do
        get_parts "$spec"
        partitions[$PNO]="$spec"
        if [[ $PTYPE == "c" ]]; then
            if [ -z "$PSIZE" ] || [ $PSIZE -lt 32 ]; then
                PSIZE=32
            fi
        fi
        (( total_size = total_size + PSIZE ))
    done
else
    echo "No -p/--partition given"
    exit 1
fi

#adjust for headers
(( total_size = total_size + 4 ))
if [ $total_size -gt $IMG_SIZE_MB ]; then
    IMG_SIZE_MB=$total_size
fi

if [[ $IS_DEBUG != "n" ]]; then
    echo "Total size of img: $IMG_SIZE_MB"
fi

rm -f fdisk_cmd
#Create fdisk command file
echo "o" >> fdisk_cmd
index=1   # number of occurrences
is_first_pass=0
for spec in "${partitions[@]}"; do
    get_parts "$spec"
    echo "n" >> fdisk_cmd
    echo "p" >> fdisk_cmd
    echo "$PNO" >> fdisk_cmd
    echo "" >> fdisk_cmd
    if [ -z "$PSIZE" ]; then
        echo "" >> fdisk_cmd
    else
        echo "+""$PSIZE""M" >> fdisk_cmd
    fi
    echo "t" >> fdisk_cmd
    if [ $is_first_pass -ne 0 ]; then
        echo "$PNO" >> fdisk_cmd
    fi
    is_first_pass=1
    echo "$PTYPE" >> fdisk_cmd
    partitions_file_list[$PTYPE]=$(list_files "$PFILES")
    (( index = index +1 ))
done
echo "w" >> fdisk_cmd

#create image file
echo "Creating SD image"
rm -f $IMG_FILE
dd if=/dev/zero of="$IMG_FILE" bs=1M count=$IMG_SIZE_MB > /dev/null 2>&1
echo "Creating partitions"
fdisk "$IMG_FILE" < fdisk_cmd > /dev/null 2>&1

start_block=( $(fdisk -l "$IMG_FILE" | awk -v f="$IMG_FILE" '$0 ~ ("^" f) { print $2 }') )
end_block=( $(fdisk -l "$IMG_FILE" | awk -v f="$IMG_FILE" '$0 ~ ("^" f) { print $3 }') )
num_blocks=( $(fdisk -l "$IMG_FILE" | awk -v f="$IMG_FILE" '$0 ~ ("^" f) { print $4 }') )
part_size=( $(fdisk -l "$IMG_FILE" | awk -v f="$IMG_FILE" '$0 ~ ("^" f) { print $5 }') )
part_type=( $(fdisk -l "$IMG_FILE" | awk -v f="$IMG_FILE" '$0 ~ ("^" f) { print $6 }') )

#setup fat filesystem
fat_offset=0
for (( i=0; i<${#part_type[@]}; i++ )); do
    if [[ ${part_type[i]} == "c" ]]; then
        echo "Creating FAT filesystem (block:${start_block[i]})"
        dd if=$IMG_FILE of=fatpart.raw bs=512 skip=${start_block[i]} count=${num_blocks[i]} > /dev/null 2>&1
        mkfs.fat -F 32 fatpart.raw
        dd if=fatpart.raw of=$IMG_FILE bs=512 seek=${start_block[i]} conv=notrunc > /dev/null 2>&1
        fat_offset=$((${start_block[i]} * 512))

        echo "drive f: file=\"$(pwd)/$IMG_FILE\" offset=$fat_offset" > mtools.conf
        for file in "${partitions_file_list["c"]}"; do
            MTOOLSRC=./mtools.conf mcopy $file f:
        done
        MTOOLSRC=./mtools.conf mdir f:
    fi
    if [[ ${part_type[i]} == "a2" ]]; then
        IMG_FIP=${partitions_file_list["a2"]}
        if [ -f $IMG_FIP ]; then
            echo "Writing FIP image (block:${start_block[i]})"
            dd if=$IMG_FIP of=$IMG_FILE bs=512 seek=${start_block[i]} conv=notrunc > /dev/null 2>&1
        fi
    fi
done
